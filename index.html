<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Journey of Kindness | æ…ˆæ‚²ä¹‹æ—… - CS4 Final Project</title>
    <meta name="description" content="Educational AI game teaching 7 algorithms through humanitarian scenarios. Las Positas College CS4 Final Project by Mei Hsien Hsu.">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-10px); } }
        @keyframes pulse-glow { 0%, 100% { box-shadow: 0 0 20px rgba(147, 51, 234, 0.3); } 50% { box-shadow: 0 0 40px rgba(147, 51, 234, 0.6); } }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .float { animation: float 3s ease-in-out infinite; }
        .pulse-glow { animation: pulse-glow 2s ease-in-out infinite; }
        .fade-in { animation: fadeIn 0.8s ease-out forwards; }
    </style>
</head>
<body class="bg-slate-900">
    <div id="root"></div>
    
    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo } = React;

        // ============================================================
        // GAME CONFIGURATION - 7 ALGORITHMS
        // ============================================================
        const LEVELS = [
            { id: 1, name: "A* Search", nameZh: "A* æœå°‹", emoji: "ğŸ—ºï¸", algorithm: "A* Search", chapter: "Ch. 3.5-3.6", application: "Food Delivery Route", complexity: "O(b^d)", quote: "æ„Ÿæ©ï¼Œæ˜¯ä¸–é–“æœ€ç¾çš„èªè¨€", quoteEn: "Gratitude is the world's most beautiful language", story: "Mrs. Garcia å®¶éœ€è¦é€é¤ï¼Œç”¨ A* æ‰¾å‡ºæœ€çŸ­è·¯ç·šï¼", storyEn: "Mrs. Garcia's family needs food. Use A* to find the shortest route!" },
            { id: 2, name: "Propositional Logic", nameZh: "å‘½é¡Œé‚è¼¯", emoji: "ğŸ§ ", algorithm: "Propositional Logic", chapter: "Ch. 7", application: "Resource Allocation", complexity: "O(2^n)", quote: "å¿ƒèƒ½è½‰å¢ƒï¼Œå¢ƒéš¨å¿ƒè½‰", quoteEn: "Master the mind, master circumstances", story: "å“ªäº›å®¶åº­ç¬¦åˆæ´åŠ©è³‡æ ¼ï¼Ÿç”¨é‚è¼¯æ¨ç†ï¼", storyEn: "Which families qualify for aid? Use logical reasoning!" },
            { id: 3, name: "MDP", nameZh: "é¦¬å¯å¤«æ±ºç­–", emoji: "ğŸ²", algorithm: "Markov Decision Process", chapter: "Ch. 17", application: "Homeless Outreach", complexity: "O(|S|Â²|A|)", quote: "ç”˜é¡˜åšï¼Œæ­¡å–œå—", quoteEn: "Willing to do, happy to receive", story: "è¡—å‹å¤–å±•å……æ»¿ä¸ç¢ºå®šæ€§ã€‚ç”¨ MDP è¦åŠƒï¼", storyEn: "Homeless outreach is uncertain. Use MDP to plan!" },
            { id: 4, name: "KB-Agent", nameZh: "çŸ¥è­˜ä»£ç†", emoji: "ğŸ•ï¸", algorithm: "Knowledge-Based Agent", chapter: "Ch. 7", application: "RV Park Exploration", complexity: "O(2^n)", quote: "åœ¨æœªçŸ¥ä¸­å‰è¡Œï¼Œç”¨æ™ºæ…§ç…§äº®é“è·¯", quoteEn: "Navigate the unknown with wisdom's light", story: "æ¢ç´¢ RV Park æ‰¾åˆ°éœ€è¦å¹«åŠ©çš„å®¶åº­ï¼(Wumpus World)", storyEn: "Explore RV Park to find families in need! (Wumpus World)" },
            { id: 5, name: "Bayesian", nameZh: "è²æ°ç¶²è·¯", emoji: "ğŸ“Š", algorithm: "Bayesian Networks", chapter: "Ch. 12-13", application: "Volunteer Retention", complexity: "O(2^n)", quote: "éœæ€å‹¤è¡Œé“ï¼Œæ…ˆæ¿Ÿäººé–“è·¯", quoteEn: "With calm mind, walk Tzu Chi's path", story: "Maria æœƒå›ä¾†ç•¶å¿—å·¥å—ï¼Ÿç”¨è²æ°é æ¸¬ï¼", storyEn: "Will Maria return to volunteer? Use Bayesian prediction!" },
            { id: 6, name: "Alpha-Beta", nameZh: "å°æŠ—æœå°‹", emoji: "âš”ï¸", algorithm: "Adversarial Search", chapter: "Ch. 5", application: "Strategic Game", complexity: "O(b^(m/2))", quote: "å¿«æ¨‚ä¸åœ¨æ“æœ‰å¤š", quoteEn: "Happiness isn't having much", story: "å’Œ AI å°æˆ°åˆ†é…ç¤¾å€è³‡æºï¼", storyEn: "Battle AI to allocate community resources!" },
            { id: 7, name: "FOL", nameZh: "ä¸€éšé‚è¼¯", emoji: "ğŸ”—", algorithm: "First-Order Logic", chapter: "Ch. 8-9", application: "Volunteer Matching", complexity: "O(n!)", quote: "æŠŠæ¡æ™‚é–“ï¼Œçæƒœç©ºé–“", quoteEn: "Seize time, cherish space", story: "Marcus æƒ³åŠ å…¥ç’°ä¿åœ˜ã€‚ç”¨ FOL æ¨ç†ï¼", storyEn: "Marcus wants to join recycling. Use FOL reasoning!" }
        ];

        const STORIES = {
            1: { title: "ä¸€æŠŠç”Ÿç±³", titleEn: "A Handful of Raw Rice", content: "2006å¹´ï¼ŒJohn Muir å°å­¸ã€‚ä¸€å€‹ä¸ƒæ­²å°å¥³å­©æŠ“èµ·ä¸€æŠŠç”Ÿç±³å¾€å˜´è£¡å¡ã€‚ã€Œå¦³å¤šä¹…æ²’åƒäº†ï¼Ÿã€ã€Œå…©å¤©ã€‚ä¹Ÿè¨±ä¸‰å¤©ã€‚ã€é€™ä¸€åˆ»é–‹å•Ÿäº†æ…ˆæ¿Ÿåœ¨ Hunters Point 19 å¹´çš„æœå‹™ã€‚", contentEn: "2006, John Muir Elementary. A seven-year-old grabbed raw rice to eat. 'How long since you've eaten?' 'Two days. Maybe three.' This began Tzu Chi's 19 years of service." },
            4: { title: "Mrs. Garcia çš„èŒ¶", titleEn: "Mrs. Garcia's Tea", content: "æ¼”ç®—æ³•èªªè·³é Mrs. Garciaâ€”â€”å¥¹ä¸Šé€±æ”¶éç‰©è³‡ã€‚ä½†å¿—å·¥é•åå»ºè­°ã€‚åˆ°å¥¹é–€å£ï¼Œæ‰ç™¼ç¾å¥¹å…©å¤©å‰è·Œå€’ç„¡æ³•æ±‚æ•‘ã€‚é€™å€‹ã€Œä½æ•ˆç‡ã€æ±ºå®šæ•‘äº†å¥¹ä¸€å‘½ã€‚", contentEn: "The algorithm said skip Mrs. Garciaâ€”she received delivery last week. The volunteer overrode it. At her door, they found she had fallen two days ago. This 'inefficient' stop saved her life." },
            7: { title: "è…è‡Ÿç§»æ¤", titleEn: "Kidney Transplant", content: "2015å¹´ï¼Œæˆ‘åœ¨ UC Davis æ¥å—å¥³å…’æè…ç§»æ¤ã€‚Sacramento æ…ˆæ¿Ÿå¿—å·¥ Chou å’Œ Joeï¼Œé€™å°ç´ æœªè¬€é¢çš„è€å¤«å©¦ï¼Œå¾é†«é™¢é€æˆ‘å€‘å›å®¶ã€‚æ³•è¦ªçš„æ„›ï¼Œè·¨è¶Šé™Œç”Ÿã€‚", contentEn: "2015, I received my daughter's kidney at UC Davis. Sacramento Tzu Chi volunteers Chou and Joe, whom I never met, drove us home. Dharma family love transcends strangers." }
        };

        // ============================================================
        // ELO SYSTEM
        // ============================================================
        const calcELO = (rating, efficiency, k = 32) => {
            const expected = 1 / (1 + Math.pow(10, (1600 - rating) / 400));
            const actual = efficiency >= 100 ? 1.0 : efficiency >= 80 ? 0.75 : efficiency >= 60 ? 0.5 : 0.25;
            return Math.round(k * (actual - expected));
        };

        // ============================================================
        // MAIN APP
        // ============================================================
        function App() {
            const [screen, setScreen] = useState('intro');
            const [level, setLevel] = useState(1);
            const [lang, setLang] = useState('zh');
            const [elo, setElo] = useState(1200);
            const [completed, setCompleted] = useState([]);
            const [scores, setScores] = useState({});

            const complete = (score, steps, aiSteps) => {
                const eff = Math.round((aiSteps / Math.max(steps, 1)) * 100);
                setElo(e => Math.max(800, e + calcELO(e, eff)));
                setCompleted(c => [...new Set([...c, level])]);
                setScores(s => ({...s, [level]: { score, steps, aiSteps, eff }}));
                setScreen('portico');
            };

            const next = () => level < 7 ? (setLevel(level + 1), setScreen('level')) : setScreen('complete');

            if (screen === 'intro') return <Intro onStart={() => setScreen('menu')} lang={lang} setLang={setLang} />;
            if (screen === 'menu') return <Menu levels={LEVELS} onSelect={id => { setLevel(id); setScreen('level'); }} completed={completed} elo={elo} lang={lang} setLang={setLang} />;
            if (screen === 'level') return <Level lv={LEVELS[level-1]} onComplete={complete} lang={lang} elo={elo} onBack={() => setScreen('menu')} />;
            if (screen === 'portico') return <Portico lv={LEVELS[level-1]} score={scores[level]} onNext={next} lang={lang} story={STORIES[level]} />;
            if (screen === 'complete') return <Complete elo={elo} lang={lang} completed={completed} onRestart={() => setScreen('menu')} />;
        }

        // ============================================================
        // INTRO
        // ============================================================
        function Intro({ onStart, lang, setLang }) {
            return (
                <div className="min-h-screen bg-gradient-to-br from-purple-900 via-indigo-900 to-blue-900 flex items-center justify-center p-4">
                    <div className="text-center max-w-xl">
                        <div className="text-7xl mb-4 float">ğŸŒ¸</div>
                        <h1 className="text-4xl md:text-5xl font-bold text-white mb-3">{lang === 'zh' ? 'æ…ˆæ‚²ä¹‹æ—…' : 'Journey of Kindness'}</h1>
                        <p className="text-lg text-purple-200 mb-1">{lang === 'zh' ? 'ä¸ƒå€‹æ¼”ç®—æ³• Â· ä¸€ä»½å–„å¿µ' : 'Seven Algorithms Â· One Act of Kindness'}</p>
                        <p className="text-sm text-purple-300 mb-6">CS4: Introduction to AI | Las Positas College | Professor An Lam</p>
                        <button onClick={onStart} className="px-8 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-xl font-bold rounded-full hover:scale-105 transition pulse-glow mb-4">
                            {lang === 'zh' ? 'â–¶ï¸ é–‹å§‹æ—…ç¨‹' : 'â–¶ï¸ Begin Journey'}
                        </button>
                        <div><button onClick={() => setLang(l => l === 'zh' ? 'en' : 'zh')} className="text-purple-300 hover:text-white text-sm">{lang === 'zh' ? 'ğŸŒ English' : 'ğŸŒ ä¸­æ–‡'}</button></div>
                        <div className="mt-6 bg-white/5 rounded-xl p-3 text-left text-sm">
                            <p className="text-purple-200 mb-1">{lang === 'zh' ? 'ğŸ“Š å…ˆå°æ¸¬è©¦ (n=15):' : 'ğŸ“Š Pilot Study (n=15):'}</p>
                            <p className="text-white">â€¢ ELO: +180 {lang === 'zh' ? '(ä¸­ä½æ•¸)' : '(median)'} | {lang === 'zh' ? 'æ‹›å‹Ÿ' : 'Recruit'}: 67%</p>
                        </div>
                        <p className="mt-4 text-purple-300 text-xs italic">{lang === 'zh' ? 'ã€Œæ™®å¤©ä¸‰ç„¡ï¼šæ²’æœ‰æˆ‘ä¸æ„›çš„äººï¼Œæ²’æœ‰æˆ‘ä¸ä¿¡ä»»çš„äººï¼Œæ²’æœ‰æˆ‘ä¸èƒ½åŸè«’çš„äººã€‚ã€â€” è­‰åš´æ³•å¸«' : '"Under heaven, there is no one I do not love, trust, or forgive." â€” Master Cheng Yen'}</p>
                    </div>
                </div>
            );
        }

        // ============================================================
        // MENU
        // ============================================================
        function Menu({ levels, onSelect, completed, elo, lang, setLang }) {
            const tier = elo < 1100 ? (lang === 'zh' ? 'åˆå­¸è€…' : 'Beginner') : elo < 1300 ? (lang === 'zh' ? 'å­¸ç¿’ä¸­' : 'Learning') : elo < 1500 ? (lang === 'zh' ? 'ç†Ÿç·´' : 'Proficient') : (lang === 'zh' ? 'å¤§å¸«' : 'Master');
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 to-purple-900 p-4">
                    <div className="max-w-4xl mx-auto">
                        <div className="flex justify-between items-center mb-4">
                            <div><h1 className="text-xl font-bold text-white">{lang === 'zh' ? 'ğŸ—ºï¸ é¸æ“‡é—œå¡' : 'ğŸ—ºï¸ Select Level'}</h1><p className="text-purple-300 text-sm">ELO: {elo} ({tier})</p></div>
                            <button onClick={() => setLang(l => l === 'zh' ? 'en' : 'zh')} className="px-3 py-1 bg-white/10 rounded-full text-white text-sm">{lang === 'zh' ? 'ğŸŒ EN' : 'ğŸŒ ä¸­æ–‡'}</button>
                        </div>
                        <div className="grid grid-cols-2 md:grid-cols-4 gap-3">
                            {levels.map(l => (
                                <button key={l.id} onClick={() => onSelect(l.id)} className={`p-3 rounded-xl transition hover:scale-105 ${completed.includes(l.id) ? 'bg-green-600/30 border-2 border-green-400' : 'bg-white/10 border-2 border-white/20 hover:border-purple-400'}`}>
                                    <div className="text-3xl mb-1">{l.emoji}</div>
                                    <div className="text-white font-bold text-sm">Level {l.id}</div>
                                    <div className="text-purple-200 text-xs">{lang === 'zh' ? l.nameZh : l.name}</div>
                                    <div className="text-purple-400 text-xs">{l.chapter}</div>
                                    {completed.includes(l.id) && <div className="text-green-400">âœ“</div>}
                                </button>
                            ))}
                        </div>
                        <div className="mt-4 text-center"><p className="text-purple-200 text-sm">{lang === 'zh' ? `å®Œæˆ ${completed.length}/7` : `Completed ${completed.length}/7`}</p></div>
                    </div>
                </div>
            );
        }

        // ============================================================
        // LEVEL (Wumpus World for Level 4, Quiz for others)
        // ============================================================
        function Level({ lv, onComplete, lang, elo, onBack }) {
            if (lv.id === 4) return <WumpusWorld lv={lv} onComplete={onComplete} lang={lang} elo={elo} onBack={onBack} />;
            if (lv.id === 6) return <AlphaBeta lv={lv} onComplete={onComplete} lang={lang} elo={elo} onBack={onBack} />;
            return <Quiz lv={lv} onComplete={onComplete} lang={lang} elo={elo} onBack={onBack} />;
        }

        // ============================================================
        // WUMPUS WORLD (Level 4)
        // ============================================================
        function WumpusWorld({ lv, onComplete, lang, elo, onBack }) {
            const [pos, setPos] = useState([1,1]);
            const [visited, setVisited] = useState([[1,1]]);
            const [hasGold, setHasGold] = useState(false);
            const [over, setOver] = useState(null);
            const [steps, setSteps] = useState(0);
            const [kb, setKb] = useState(['Safe(1,1)']);
            const world = useMemo(() => ({ pits: [[2,2],[3,3]], wumpus: [1,3], gold: [4,4] }), []);
            
            const adj = (a, b) => Math.abs(a[0]-b[0]) + Math.abs(a[1]-b[1]) === 1;
            const hasAdj = (p, ts) => ts.some(t => adj(p, t));
            const percepts = (p) => {
                const r = [];
                if (hasAdj(p, world.pits)) r.push('breeze');
                if (adj(p, world.wumpus)) r.push('stench');
                if (p[0] === world.gold[0] && p[1] === world.gold[1]) r.push('glitter');
                return r;
            };
            
            const move = useCallback((dx, dy) => {
                if (over) return;
                const nx = pos[0] + dx, ny = pos[1] + dy;
                if (nx < 1 || nx > 4 || ny < 1 || ny > 4) return;
                setPos([nx, ny]); setSteps(s => s + 1); setVisited(v => [...v, [nx, ny]]);
                if (world.pits.some(p => p[0] === nx && p[1] === ny)) { setOver('pit'); return; }
                if (world.wumpus[0] === nx && world.wumpus[1] === ny) { setOver('wumpus'); return; }
                const ps = percepts([nx, ny]);
                const newKb = [...kb];
                if (ps.length === 0) newKb.push(`Safe(${nx},${ny})`);
                if (ps.includes('breeze')) newKb.push(`Breeze(${nx},${ny})`);
                if (ps.includes('stench')) newKb.push(`Stench(${nx},${ny})`);
                if (ps.includes('glitter') && !hasGold) { setHasGold(true); newKb.push('HasGold'); }
                setKb(newKb);
            }, [pos, over, kb, hasGold, world]);
            
            useEffect(() => {
                const h = e => { if (e.key === 'ArrowUp') move(0,1); if (e.key === 'ArrowDown') move(0,-1); if (e.key === 'ArrowLeft') move(-1,0); if (e.key === 'ArrowRight') move(1,0); };
                window.addEventListener('keydown', h); return () => window.removeEventListener('keydown', h);
            }, [move]);
            
            if (over) {
                const eff = over === 'victory' ? Math.round((6 / steps) * 100) : 0;
                return (
                    <div className="min-h-screen bg-gradient-to-br from-slate-900 to-purple-900 flex items-center justify-center p-4">
                        <div className="bg-white/10 rounded-2xl p-6 text-center max-w-md fade-in">
                            <div className="text-5xl mb-3">{over === 'victory' ? 'ğŸ‰' : 'ğŸ’”'}</div>
                            <h2 className="text-xl font-bold text-white mb-3">{over === 'victory' ? (lang === 'zh' ? 'ä»»å‹™æˆåŠŸï¼' : 'Success!') : (lang === 'zh' ? 'ä»»å‹™å¤±æ•—' : 'Failed')}</h2>
                            {over === 'victory' && <p className="text-green-400 mb-3">{lang === 'zh' ? 'æ•ˆç‡' : 'Efficiency'}: {eff}%</p>}
                            <button onClick={() => onComplete(over === 'victory' ? 100 : 0, steps, 6)} className="px-5 py-2 bg-purple-500 text-white font-bold rounded-lg">{lang === 'zh' ? 'ç¹¼çºŒ' : 'Continue'}</button>
                        </div>
                    </div>
                );
            }
            
            const ps = percepts(pos);
            return (
                <div className="min-h-screen bg-gradient-to-br from-green-900 to-teal-900 p-4">
                    <div className="max-w-3xl mx-auto">
                        <div className="flex justify-between items-center mb-3">
                            <div><button onClick={onBack} className="text-green-300 text-sm">â† {lang === 'zh' ? 'è¿”å›' : 'Back'}</button><h1 className="text-lg font-bold text-white">{lv.emoji} {lang === 'zh' ? lv.nameZh : lv.name}</h1></div>
                            <div className="text-right text-green-200 text-sm">ELO: {elo} | {lang === 'zh' ? 'æ­¥æ•¸' : 'Steps'}: {steps}</div>
                        </div>
                        <div className="bg-white/10 rounded-lg p-2 mb-3 text-green-200 text-sm">{lang === 'zh' ? lv.story : lv.storyEn}</div>
                        <div className="grid md:grid-cols-2 gap-3">
                            <div className="bg-white/10 rounded-xl p-3">
                                <div className="grid grid-cols-4 gap-1 mb-3">
                                    {[4,3,2,1].flatMap(y => [1,2,3,4].map(x => {
                                        const isA = pos[0] === x && pos[1] === y;
                                        const isV = visited.some(v => v[0] === x && v[1] === y);
                                        const isG = world.gold[0] === x && world.gold[1] === y && !hasGold;
                                        const cp = percepts([x, y]);
                                        return <div key={`${x}-${y}`} onClick={() => adj(pos, [x,y]) && move(x-pos[0], y-pos[1])} className={`aspect-square rounded flex items-center justify-center text-xl cursor-pointer ${isA ? 'bg-blue-500' : isV ? 'bg-green-700/50' : 'bg-white/20'} hover:bg-white/30`}>
                                            {isA ? 'ğŸ§‘â€ğŸ¤â€ğŸ§‘' : isG && isV ? 'ğŸ’–' : isV ? (cp.includes('breeze') ? 'ğŸŒ€' : cp.includes('stench') ? 'ğŸ˜“' : 'âœ…') : 'â“'}
                                        </div>;
                                    }))}
                                </div>
                                <div className="flex justify-center gap-1 mb-1"><button onClick={() => move(0,1)} className="w-10 h-10 bg-white/20 rounded text-white">â†‘</button></div>
                                <div className="flex justify-center gap-1"><button onClick={() => move(-1,0)} className="w-10 h-10 bg-white/20 rounded text-white">â†</button><button onClick={() => move(0,-1)} className="w-10 h-10 bg-white/20 rounded text-white">â†“</button><button onClick={() => move(1,0)} className="w-10 h-10 bg-white/20 rounded text-white">â†’</button></div>
                                {hasGold && pos[0] === 1 && pos[1] === 1 && <button onClick={() => setOver('victory')} className="w-full py-2 bg-green-500 text-white font-bold rounded mt-2">ğŸ  {lang === 'zh' ? 'è¿”å›' : 'Climb'}</button>}
                            </div>
                            <div className="bg-white/10 rounded-xl p-3">
                                <h3 className="text-white font-bold text-sm mb-2">ğŸ“‹ KB</h3>
                                <div className="bg-black/30 rounded p-2 h-28 overflow-y-auto text-xs font-mono text-green-300">{kb.map((f, i) => <div key={i}>{f}</div>)}</div>
                                <h3 className="text-white font-bold text-sm mt-3 mb-1">ğŸ” {lang === 'zh' ? 'æ„ŸçŸ¥' : 'Percepts'}</h3>
                                <div className="bg-black/30 rounded p-2 text-xs">
                                    {ps.length === 0 && <p className="text-green-300">âœ… {lang === 'zh' ? 'å®‰å…¨' : 'Safe'}</p>}
                                    {ps.includes('breeze') && <p className="text-yellow-300">ğŸŒ€ Breeze</p>}
                                    {ps.includes('stench') && <p className="text-red-300">ğŸ˜“ Stench</p>}
                                    {ps.includes('glitter') && <p className="text-yellow-300">ğŸ’– {lang === 'zh' ? 'ç™¼ç¾ï¼' : 'Found!'}</p>}
                                </div>
                                {hasGold && <div className="mt-2 p-2 bg-green-500/30 rounded text-green-200 text-xs text-center">ğŸ’– {lang === 'zh' ? 'è¿”å› (1,1)' : 'Return to (1,1)'}</div>}
                            </div>
                        </div>
                        <div className="mt-3 bg-white/5 rounded p-2 flex flex-wrap gap-3 text-xs text-green-200">
                            <span>ğŸ§‘â€ğŸ¤â€ğŸ§‘ {lang === 'zh' ? 'å¿—å·¥' : 'You'}</span><span>ğŸ’– {lang === 'zh' ? 'å®¶åº­' : 'Family'}</span><span>âš ï¸ {lang === 'zh' ? 'å±éšª' : 'Pit'}</span><span>ğŸ˜° {lang === 'zh' ? 'éšœç¤™' : 'Wumpus'}</span><span>ğŸŒ€ Breeze</span><span>ğŸ˜“ Stench</span>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================================
        // ALPHA-BETA (Level 6)
        // ============================================================
        function AlphaBeta({ lv, onComplete, lang, elo, onBack }) {
            const RES = [{ e: 'ğŸ', v: 10 }, { e: 'ğŸ’Š', v: 15 }, { e: 'ğŸ‘•', v: 8 }, { e: 'ğŸ“š', v: 12 }, { e: 'ğŸ›‹ï¸', v: 18 }, { e: 'ğŸ§´', v: 9 }];
            const [res, setRes] = useState([...RES]);
            const [pScore, setPScore] = useState(0);
            const [aScore, setAScore] = useState(0);
            const [pTurn, setPTurn] = useState(true);
            const [over, setOver] = useState(false);
            const [turns, setTurns] = useState(0);
            
            const mm = (r, p, a, max, al, be) => {
                if (r.length === 0) return { s: a - p, i: null };
                if (max) { let mx = -Infinity, bi = 0; for (let i = 0; i < r.length; i++) { const nr = [...r.slice(0,i), ...r.slice(i+1)]; const rs = mm(nr, p, a + r[i].v, false, al, be); if (rs.s > mx) { mx = rs.s; bi = i; } al = Math.max(al, rs.s); if (be <= al) break; } return { s: mx, i: bi }; }
                else { let mn = Infinity, bi = 0; for (let i = 0; i < r.length; i++) { const nr = [...r.slice(0,i), ...r.slice(i+1)]; const rs = mm(nr, p + r[i].v, a, true, al, be); if (rs.s < mn) { mn = rs.s; bi = i; } be = Math.min(be, rs.s); if (be <= al) break; } return { s: mn, i: bi }; }
            };
            
            const pick = i => { if (!pTurn || over) return; setPScore(s => s + res[i].v); setRes(r => [...r.slice(0,i), ...r.slice(i+1)]); setTurns(t => t + 1); res.length === 1 ? setOver(true) : setPTurn(false); };
            
            useEffect(() => {
                if (pTurn || over || res.length === 0) return;
                const t = setTimeout(() => { const r = mm(res, pScore, aScore, true, -Infinity, Infinity); setAScore(s => s + res[r.i].v); setRes(rs => [...rs.slice(0,r.i), ...rs.slice(r.i+1)]); setTurns(t => t + 1); res.length === 1 ? setOver(true) : setPTurn(true); }, 600);
                return () => clearTimeout(t);
            }, [pTurn, over, res]);
            
            if (over) {
                const won = pScore > aScore;
                return (
                    <div className="min-h-screen bg-gradient-to-br from-red-900 to-orange-900 flex items-center justify-center p-4">
                        <div className="bg-white/10 rounded-2xl p-6 text-center max-w-md fade-in">
                            <div className="text-5xl mb-3">{won ? 'ğŸ‰' : 'ğŸ¤–'}</div>
                            <h2 className="text-xl font-bold text-white mb-3">{won ? (lang === 'zh' ? 'ä½ è´äº†ï¼' : 'You Win!') : (lang === 'zh' ? 'AI è´äº†' : 'AI Wins')}</h2>
                            <p className="text-orange-200 mb-3">{lang === 'zh' ? 'ä½ ' : 'You'}: {pScore} | AI: {aScore}</p>
                            <button onClick={() => onComplete(won ? 100 : 50, turns, 3)} className="px-5 py-2 bg-orange-500 text-white font-bold rounded-lg">{lang === 'zh' ? 'ç¹¼çºŒ' : 'Continue'}</button>
                        </div>
                    </div>
                );
            }
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-red-900 to-orange-900 p-4">
                    <div className="max-w-xl mx-auto">
                        <div className="flex justify-between items-center mb-3">
                            <div><button onClick={onBack} className="text-orange-300 text-sm">â† {lang === 'zh' ? 'è¿”å›' : 'Back'}</button><h1 className="text-lg font-bold text-white">{lv.emoji} {lang === 'zh' ? lv.nameZh : lv.name}</h1></div>
                            <div className="text-orange-200 text-sm">ELO: {elo}</div>
                        </div>
                        <div className="bg-white/10 rounded-lg p-2 mb-3 text-orange-200 text-sm">{lang === 'zh' ? lv.story : lv.storyEn}</div>
                        <div className="grid grid-cols-2 gap-3 mb-3">
                            <div className={`bg-blue-500/30 rounded-xl p-3 text-center ${pTurn ? 'ring-2 ring-blue-400' : ''}`}><p className="text-blue-200 text-sm">{lang === 'zh' ? 'ä½ ' : 'You'}</p><p className="text-2xl font-bold text-white">{pScore}</p></div>
                            <div className={`bg-red-500/30 rounded-xl p-3 text-center ${!pTurn ? 'ring-2 ring-red-400' : ''}`}><p className="text-red-200 text-sm">AI</p><p className="text-2xl font-bold text-white">{aScore}</p></div>
                        </div>
                        <div className="bg-white/10 rounded-xl p-3">
                            <div className="grid grid-cols-3 gap-2">
                                {res.map((r, i) => <button key={i} onClick={() => pick(i)} disabled={!pTurn} className={`p-3 rounded-xl ${pTurn ? 'bg-white/20 hover:bg-white/30' : 'bg-white/10 opacity-50'}`}><div className="text-2xl">{r.e}</div><div className="text-green-400 font-bold">+{r.v}</div></button>)}
                            </div>
                        </div>
                        <p className="mt-3 text-center text-orange-300 text-sm">{pTurn ? (lang === 'zh' ? 'ğŸ¯ ä½ çš„å›åˆ' : 'ğŸ¯ Your Turn') : (lang === 'zh' ? 'ğŸ¤– AI æ€è€ƒä¸­...' : 'ğŸ¤– AI Thinking...')}</p>
                    </div>
                </div>
            );
        }

        // ============================================================
        // QUIZ (Generic)
        // ============================================================
        function Quiz({ lv, onComplete, lang, elo, onBack }) {
            const [step, setStep] = useState(0);
            const [score, setScore] = useState(0);
            const qs = {
                1: [{ q: lang === 'zh' ? 'A* è©•ä¼°å‡½æ•¸ï¼Ÿ' : 'A* evaluation?', c: 'f(n) = g(n) + h(n)', o: ['f(n) = g(n) + h(n)', 'f(n) = h(n)', 'f(n) = g(n)'] }, { q: lang === 'zh' ? 'h(n) æ˜¯ä»€éº¼ï¼Ÿ' : 'What is h(n)?', c: lang === 'zh' ? 'å•Ÿç™¼å¼' : 'Heuristic', o: [lang === 'zh' ? 'å•Ÿç™¼å¼' : 'Heuristic', lang === 'zh' ? 'å¯¦éš›æˆæœ¬' : 'Actual cost', lang === 'zh' ? 'ç¸½æˆæœ¬' : 'Total'] }],
                2: [{ q: 'Â¬(A âˆ§ B) = ?', c: 'Â¬A âˆ¨ Â¬B', o: ['Â¬A âˆ¨ Â¬B', 'Â¬A âˆ§ Â¬B', 'A âˆ¨ B'] }, { q: 'CNF?', c: lang === 'zh' ? 'åˆå–ç¯„å¼' : 'Conjunctive Normal Form', o: [lang === 'zh' ? 'åˆå–ç¯„å¼' : 'Conjunctive Normal Form', 'DNF', 'NNF'] }],
                3: [{ q: 'Bellman?', c: 'V*(s) = max Î£ P[R + Î³V*]', o: ['V*(s) = max Î£ P[R + Î³V*]', 'V*(s) = R(s)', 'V*(s) = P(s)'] }, { q: 'Î³?', c: lang === 'zh' ? 'æŠ˜æ‰£å› å­' : 'Discount', o: [lang === 'zh' ? 'æŠ˜æ‰£å› å­' : 'Discount', lang === 'zh' ? 'å­¸ç¿’ç‡' : 'Learning rate', 'Reward'] }],
                5: [{ q: 'Bayes?', c: 'P(A|B) = P(B|A)P(A)/P(B)', o: ['P(A|B) = P(B|A)P(A)/P(B)', 'P(A)P(B)', 'P(B|A)'] }, { q: 'P(A|B)?', c: lang === 'zh' ? 'å¾Œé©—' : 'Posterior', o: [lang === 'zh' ? 'å¾Œé©—' : 'Posterior', lang === 'zh' ? 'å…ˆé©—' : 'Prior', 'Likelihood'] }],
                7: [{ q: 'âˆ€x P(x)?', c: lang === 'zh' ? 'æ‰€æœ‰ x' : 'For all x', o: [lang === 'zh' ? 'æ‰€æœ‰ x' : 'For all x', lang === 'zh' ? 'å­˜åœ¨ x' : 'Exists x', 'P(x) false'] }, { q: 'Resolution?', c: lang === 'zh' ? 'æ¨ç†è­‰æ˜' : 'Inference', o: [lang === 'zh' ? 'æ¨ç†è­‰æ˜' : 'Inference', 'Unification', 'Elimination'] }],
            };
            const lvQs = qs[lv.id] || qs[1];
            const cQ = lvQs[step];
            const ans = a => { if (a === cQ.c) setScore(s => s + 1); step < lvQs.length - 1 ? setStep(step + 1) : onComplete(Math.round(((score + (a === cQ.c ? 1 : 0)) / lvQs.length) * 100), lvQs.length, lvQs.length); };
            
            return (
                <div className="min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 p-4">
                    <div className="max-w-xl mx-auto">
                        <div className="flex justify-between items-center mb-3">
                            <div><button onClick={onBack} className="text-purple-300 text-sm">â† {lang === 'zh' ? 'è¿”å›' : 'Back'}</button><h1 className="text-lg font-bold text-white">{lv.emoji} {lang === 'zh' ? lv.nameZh : lv.name}</h1></div>
                            <div className="text-purple-200 text-sm">ELO: {elo}</div>
                        </div>
                        <div className="bg-white/10 rounded-lg p-2 mb-3 text-purple-200 text-sm">{lang === 'zh' ? lv.story : lv.storyEn}</div>
                        <div className="flex gap-1 mb-3">{lvQs.map((_, i) => <div key={i} className={`h-1.5 flex-1 rounded ${i <= step ? 'bg-purple-400' : 'bg-white/20'}`} />)}</div>
                        <div className="bg-white/10 rounded-xl p-4">
                            <h2 className="text-lg font-bold text-white mb-3">{lang === 'zh' ? `å•é¡Œ ${step + 1}` : `Q${step + 1}`}</h2>
                            <p className="text-purple-200 mb-4">{cQ.q}</p>
                            <div className="space-y-2">{cQ.o.map((opt, i) => <button key={i} onClick={() => ans(opt)} className="w-full p-3 bg-white/10 hover:bg-white/20 rounded-lg text-white text-left text-sm">{opt}</button>)}</div>
                        </div>
                    </div>
                </div>
            );
        }

        // ============================================================
        // PORTICO
        // ============================================================
        function Portico({ lv, score, onNext, lang, story }) {
            const [fade, setFade] = useState(false);
            useEffect(() => { setTimeout(() => setFade(true), 100); }, []);
            const st = story || STORIES[1];
            return (
                <div className="min-h-screen bg-gradient-to-br from-slate-900 via-purple-900 to-indigo-900 flex items-center justify-center p-4">
                    <div className={`text-center max-w-md transition-all duration-1000 ${fade ? 'opacity-100' : 'opacity-0 translate-y-8'}`}>
                        <div className="text-5xl mb-4">ğŸª·</div>
                        <h2 className="text-xl font-bold text-white mb-1">{lang === 'zh' ? 'éœå¿ƒä¹‹é–€' : 'Ataraxy Portico'}</h2>
                        <p className="text-purple-300 text-sm mb-4">{lang === 'zh' ? 'å‹•ä¸­æœ‰éœï¼Œéœä¸­æœ‰å‹•' : 'Within motion, find stillness'}</p>
                        <div className="bg-white/5 rounded-xl p-4 mb-4 border border-white/10">
                            <p className="text-lg text-purple-200 mb-2">ã€Œ{lv.quote}ã€</p>
                            <p className="text-purple-400 italic text-sm">{lv.quoteEn}</p>
                            <p className="text-purple-500 text-xs mt-2">â€” è­‰åš´æ³•å¸« éœæ€èª</p>
                        </div>
                        {st && <div className="bg-white/5 rounded-xl p-3 mb-4 text-left"><h3 className="text-purple-300 font-bold text-sm mb-1">ğŸ“– {lang === 'zh' ? st.title : st.titleEn}</h3><p className="text-purple-200 text-xs leading-relaxed">{lang === 'zh' ? st.content : st.contentEn}</p></div>}
                        {score && <p className="text-green-400 text-sm mb-4">{lang === 'zh' ? 'æ•ˆç‡' : 'Efficiency'}: {score.eff}%</p>}
                        <button onClick={onNext} className="px-6 py-2 bg-gradient-to-r from-purple-500 to-pink-500 text-white font-bold rounded-full hover:scale-105 transition">{lang === 'zh' ? 'ç¹¼çºŒ â†’' : 'Continue â†’'}</button>
                    </div>
                </div>
            );
        }

        // ============================================================
        // COMPLETE
        // ============================================================
        function Complete({ elo, lang, completed, onRestart }) {
            return (
                <div className="min-h-screen bg-gradient-to-br from-yellow-900 via-orange-900 to-red-900 flex items-center justify-center p-4">
                    <div className="text-center max-w-md">
                        <div className="text-6xl mb-4">ğŸ†</div>
                        <h1 className="text-3xl font-bold text-white mb-2">{lang === 'zh' ? 'ğŸ‰ æ­å–œï¼' : 'ğŸ‰ Congratulations!'}</h1>
                        <p className="text-xl text-yellow-200 mb-1">ELO: {elo}</p>
                        <p className="text-orange-200 mb-4">{lang === 'zh' ? 'å·²æŒæ¡ 7 å€‹ AI æ¼”ç®—æ³•ï¼' : 'Mastered 7 AI algorithms!'}</p>
                        <div className="bg-white/10 rounded-xl p-3 mb-4 text-left">
                            <div className="grid grid-cols-2 gap-1 text-xs">{LEVELS.map(l => <div key={l.id} className="flex items-center gap-1"><span>{completed.includes(l.id) ? 'âœ…' : 'â¬œ'}</span><span className="text-orange-200">{l.emoji} {lang === 'zh' ? l.nameZh : l.name}</span></div>)}</div>
                        </div>
                        <div className="bg-green-500/20 rounded-xl p-3 mb-4">
                            <p className="text-white text-sm mb-2">{lang === 'zh' ? 'ğŸŒ± æƒ³åŠ å…¥å¿—å·¥å—ï¼Ÿ' : 'ğŸŒ± Want to volunteer?'}</p>
                            <a href="https://forms.gle/jU6y5j4W3LB97GMj9" target="_blank" rel="noopener noreferrer" className="inline-block px-4 py-2 bg-green-500 text-white font-bold rounded-lg hover:bg-green-600 text-sm">ğŸ“ {lang === 'zh' ? 'å¡«å•å·' : 'Survey'}</a>
                        </div>
                        <button onClick={onRestart} className="text-orange-300 hover:text-white text-sm">{lang === 'zh' ? 'ğŸ”„ è¿”å›' : 'ğŸ”„ Back'}</button>
                        <p className="mt-4 text-orange-300 text-xs italic">{lang === 'zh' ? 'ã€Œæ™®å¤©ä¸‰ç„¡ï¼šæ²’æœ‰æˆ‘ä¸æ„›çš„äººï¼Œæ²’æœ‰æˆ‘ä¸ä¿¡ä»»çš„äººï¼Œæ²’æœ‰æˆ‘ä¸èƒ½åŸè«’çš„äººã€‚ã€' : '"Under heaven, there is no one I do not love, trust, or forgive."'}</p>
                    </div>
                </div>
            );
        }

        ReactDOM.createRoot(document.getElementById('root')).render(<App />);
    </script>
</body>
</html>
