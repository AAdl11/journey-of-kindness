<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="google" content="notranslate">
    <title>å–„çš„æ—…ç¨‹ Level 2: Propositional Logic | Happy Campus</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&family=JetBrains+Mono:wght@400;500&display=swap" rel="stylesheet">
    <style>
        * { font-family: 'Noto Sans TC', sans-serif; box-sizing: border-box; margin: 0; padding: 0; }
        .mono { font-family: 'JetBrains Mono', monospace; }
        
        .screen { display: none; min-height: 100vh; position: relative; }
        .screen.active { display: flex; }
        
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes pulseGlow { 0%, 100% { box-shadow: 0 0 20px rgba(251, 191, 36, 0.6); } 50% { box-shadow: 0 0 40px rgba(251, 191, 36, 0.9); } }
        @keyframes breatheRing { 0%, 100% { transform: scale(0.85); opacity: 0.7; } 50% { transform: scale(1.15); opacity: 1; } }
        @keyframes float { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-12px); } }
        @keyframes sparkle { 0%, 100% { opacity: 1; transform: scale(1); } 50% { opacity: 0.8; transform: scale(1.1); } }
        @keyframes bounce { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-8px); } }
        
        .fade-in { animation: fadeIn 0.8s ease-out; }
        .slide-up { animation: slideUp 0.6s ease-out; }
        .pulse-glow { animation: pulseGlow 2s infinite; }
        .float { animation: float 2.5s ease-in-out infinite; }
        .sparkle { animation: sparkle 1.5s ease-in-out infinite; }
        .bounce { animation: bounce 1s ease-in-out infinite; }
        
        /* ========================================
           ğŸŒˆ BACKGROUNDS - SHOW THE BEAUTIFUL ART!
        ======================================== */
        
        /* Intro - Let the ceremony image SHINE! */
        .bg-ceremony {
            background: url('L2_ceremony.png') center center/cover no-repeat;
            background-color: #fce7f3;
        }
        
        /* Shop - Bright playground */
        .bg-playground {
            background: url('L2_p2_Scool.png') center center/cover no-repeat;
            background-color: #ecfdf5;
        }
        
        /* Ataraxy - Show the beautiful gate with its built-in water */
        .bg-ataraxy {
            background: url('ataraxy_gate.png') center center/contain no-repeat;
            background-color: #c4b5fd;
        }
        
        /* Breathing ring - smaller */
        .breath-ring {
            width: 120px; height: 120px; border-radius: 50%;
            border: 4px solid rgba(251, 191, 36, 0.9);
            animation: breatheRing 4s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.5);
            display: flex; align-items: center; justify-content: center;
            background: rgba(255, 255, 255, 0.2);
            backdrop-filter: blur(5px);
        }
        
        /* å¢å¼·ç‰ˆå‘¼å¸å…‰æšˆ - æ›´å¤§æ›´äº®ï¼ */
        .breath-ring-enhanced {
            width: 200px; height: 200px; border-radius: 50%;
            border: 6px solid rgba(251, 191, 36, 1);
            animation: breatheRingEnhanced 4s ease-in-out infinite;
            box-shadow: 0 0 40px rgba(251, 191, 36, 0.9), 0 0 80px rgba(251, 191, 36, 0.6), 0 0 120px rgba(251, 191, 36, 0.3);
            display: flex; align-items: center; justify-content: center;
            background: radial-gradient(circle, rgba(255,255,255,0.5) 0%, rgba(251,191,36,0.2) 100%);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        
        @keyframes breatheRingEnhanced {
            0%, 100% { 
                transform: scale(0.9); 
                box-shadow: 0 0 40px rgba(251, 191, 36, 0.7), 0 0 80px rgba(251, 191, 36, 0.4);
            }
            50% { 
                transform: scale(1.15); 
                box-shadow: 0 0 60px rgba(251, 191, 36, 1), 0 0 120px rgba(251, 191, 36, 0.7), 0 0 180px rgba(251, 191, 36, 0.4);
            }
        }
        
        /* Apple iOS é¢¨æ ¼æ¯›ç»ç’ƒ - Glassmorphism */
        .jingsi-card {
            background: rgba(255, 255, 255, 0.25);
            backdrop-filter: blur(25px);
            -webkit-backdrop-filter: blur(25px);
            border-radius: 28px; padding: 1.5rem 2.5rem; max-width: 500px;
            text-align: center; 
            border: 1px solid rgba(255, 255, 255, 0.35);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.08), inset 0 0 0 1px rgba(255,255,255,0.1);
        }
        
        /* Layout */
        .game-layout {
            display: flex;
            gap: 12px;
            flex: 1;
            max-width: 1400px;
            margin: 0 auto;
            width: 100%;
        }
        
        .main-area { flex: 2; display: flex; flex-direction: column; gap: 10px; }
        .side-panel { flex: 1; max-width: 320px; display: flex; flex-direction: column; gap: 10px; }
        
        /* Game Header - æ›´é€æ˜ï¼ */
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 16px;
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.8), rgba(254, 243, 199, 0.75));
            border-radius: 12px;
            border: 2px solid rgba(251, 191, 36, 0.4);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(8px);
        }
        
        .elo-badge {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            color: #1f2937;
            padding: 6px 14px;
            border-radius: 9999px;
            font-weight: bold;
            font-size: 0.9rem;
            box-shadow: 0 3px 10px rgba(251, 191, 36, 0.4);
        }
        
        /* Music button - VISIBLE! */
        .music-btn {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            color: white;
            border: none;
            padding: 8px 14px;
            border-radius: 9999px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1rem;
        }
        
        .music-btn:hover { transform: scale(1.05); }
        .music-btn.muted { background: linear-gradient(135deg, #9ca3af, #6b7280); }
        
        /* Info Boxes - æ›´é€æ˜ï¼ */
        .info-box {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.75), rgba(249, 250, 251, 0.7));
            border: 2px solid rgba(209, 213, 219, 0.6);
            border-radius: 12px;
            padding: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
            color: #1f2937;
            backdrop-filter: blur(6px);
        }
        
        .info-title { font-weight: bold; font-size: 14px; margin-bottom: 8px; color: #7c3aed; }
        
        /* Intro card - æ›´é€æ˜ï¼è®“æ ¡é•·å’Œ Roxanne éœ²å‡ºä¾† */
        .intro-card {
            background: linear-gradient(135deg, rgba(255,255,255,0.6), rgba(254,243,199,0.55));
            backdrop-filter: blur(6px);
            padding: 1.2rem 1.5rem;
            border-radius: 20px;
            border: 3px solid rgba(251,191,36,0.5);
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            max-width: 480px;
        }
        
        /* Ceremony Stage - æ›´é€æ˜ï¼çœ‹åˆ°æ ¡é•·å’Œè¬›å°ä¸Šçš„äºº */
        .ceremony-stage {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(254, 243, 199, 0.65));
            border: 3px solid rgba(251, 191, 36, 0.6);
            border-radius: 20px;
            padding: 24px;
            text-align: center;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
            backdrop-filter: blur(6px);
        }
        
        .award-student {
            display: inline-block;
            background: linear-gradient(135deg, #fce7f3, #fbcfe8);
            border: 3px solid #ec4899;
            border-radius: 16px;
            padding: 20px 50px;
            margin: 16px 0;
            box-shadow: 0 5px 20px rgba(236, 72, 153, 0.2);
        }
        
        .certificate {
            background: linear-gradient(135deg, #fef3c7, #fde68a);
            color: #78350f;
            border: 4px solid #d97706;
            border-radius: 10px;
            padding: 18px 28px;
            display: inline-block;
            margin: 16px 0;
            box-shadow: 0 8px 30px rgba(217, 119, 6, 0.3);
        }
        
        .award-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            color: white;
            padding: 16px 36px;
            border-radius: 14px;
            font-size: 1.15rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 5px 20px rgba(34, 197, 94, 0.4);
        }
        
        .award-btn:hover:not(:disabled) { transform: translateY(-3px); box-shadow: 0 8px 30px rgba(34, 197, 94, 0.6); }
        .award-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Student Card - æ›´é€æ˜ï¼ */
        .student-card {
            background: linear-gradient(135deg, rgba(252, 231, 243, 0.75), rgba(245, 208, 254, 0.7));
            border: 3px solid #d946ef;
            border-radius: 16px;
            padding: 18px;
            box-shadow: 0 5px 20px rgba(217, 70, 239, 0.2);
            backdrop-filter: blur(8px);
        }
        
        .student-avatar { font-size: 3.8rem; }
        
        .tiger-paw-badge {
            background: linear-gradient(135deg, #f97316, #ea580c);
            color: white;
            padding: 10px 18px;
            border-radius: 14px;
            font-weight: bold;
            font-size: 1.2rem;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 4px 15px rgba(249, 115, 22, 0.4);
        }
        
        /* Shop Area - æ›´é€æ˜ï¼ */
        .shop-area {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.7), rgba(240, 253, 244, 0.65));
            border: 2px solid rgba(34, 197, 94, 0.5);
            border-radius: 16px;
            padding: 16px;
            flex: 1;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.08);
            backdrop-filter: blur(6px);
        }
        
        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 12px;
            margin-top: 12px;
        }
        
        /* éŸ¿æ‡‰å¼è¨­è¨ˆ - å¤§è¢å¹•æ›´å¤§çš„å¡ç‰‡ */
        @media (min-width: 1200px) {
            .products-grid {
                grid-template-columns: repeat(auto-fill, minmax(140px, 1fr));
                gap: 14px;
            }
        }
        
        @media (min-width: 1600px) {
            .products-grid {
                grid-template-columns: repeat(6, 1fr);
                gap: 16px;
            }
        }
        
        .product-item {
            background: linear-gradient(135deg, #ffffff, #f0fdf4);
            border: 3px solid #86efac;
            border-radius: 16px;
            padding: 14px 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            color: #1f2937;
            min-height: 110px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .product-item:hover:not(.disabled) {
            transform: scale(1.08);
            border-color: #22c55e;
            background: linear-gradient(135deg, #dcfce7, #bbf7d0);
            box-shadow: 0 8px 25px rgba(34, 197, 94, 0.4);
        }
        
        .product-item.in-cart {
            border-color: #22c55e;
            background: linear-gradient(135deg, #bbf7d0, #86efac);
            box-shadow: 0 0 25px rgba(34, 197, 94, 0.5);
        }
        
        .product-item.disabled { opacity: 0.35; cursor: not-allowed; }
        
        .product-emoji { font-size: 2.5rem; }
        .product-name { font-size: 0.85rem; color: #374151; margin-top: 6px; font-weight: 500; }
        .product-price { font-size: 0.95rem; color: #ea580c; font-weight: bold; margin-top: 4px; }
        
        /* Cart Area - æ›´é€æ˜ï¼ */
        .cart-area {
            background: linear-gradient(135deg, rgba(220, 252, 231, 0.75), rgba(187, 247, 208, 0.7));
            border: 2px solid #22c55e;
            border-radius: 14px;
            padding: 14px;
            color: #1f2937;
            backdrop-filter: blur(6px);
        }
        
        .cart-items { display: flex; flex-wrap: wrap; gap: 8px; min-height: 45px; }
        
        .cart-item {
            background: white;
            border: 2px solid #86efac;
            border-radius: 10px;
            padding: 6px 12px;
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s;
            color: #1f2937;
        }
        
        .cart-item:hover { background: #fee2e2; border-color: #ef4444; }
        
        .cart-total {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px dashed #22c55e;
            flex-wrap: wrap;
            gap: 10px;
        }
        
        .checkout-btn {
            background: linear-gradient(135deg, #22c55e, #16a34a);
            border: none;
            color: white;
            padding: 12px 24px;
            border-radius: 12px;
            font-weight: bold;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.2s;
            box-shadow: 0 4px 15px rgba(34, 197, 94, 0.4);
        }
        
        .checkout-btn:hover:not(:disabled) { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(34, 197, 94, 0.5); }
        .checkout-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        /* Logic Display */
        .logic-rule {
            background: linear-gradient(135deg, #f3e8ff, #e9d5ff);
            border-radius: 10px;
            padding: 10px;
            font-family: 'JetBrains Mono', monospace;
            font-size: 0.85rem;
            color: #1f2937;
        }
        
        .logic-true { color: #16a34a; font-weight: bold; }
        .logic-false { color: #dc2626; font-weight: bold; }
        
        /* Result Overlay */
        .result-overlay {
            position: fixed;
            top: 0; left: 0; right: 0; bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 100;
        }
        
        .result-card {
            background: linear-gradient(135deg, #ffffff, #fef3c7);
            border-radius: 24px;
            padding: 2.5rem;
            text-align: center;
            max-width: 420px;
            border: 4px solid;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            color: #1f2937;
        }
        
        .result-card.correct { border-color: #22c55e; }
        .result-card.incorrect { border-color: #ef4444; }
        .result-card.sad { border-color: #3b82f6; background: linear-gradient(135deg, #ffffff, #dbeafe); }
        .result-card.ok { border-color: #eab308; background: linear-gradient(135deg, #ffffff, #fef9c3); }
        
        /* Progress Bar */
        .progress-container {
            background: rgba(255, 255, 255, 0.6);
            border-radius: 10px;
            height: 10px;
            overflow: hidden;
            border: 1px solid rgba(0, 0, 0, 0.1);
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ec4899, #8b5cf6, #3b82f6);
            border-radius: 10px;
            transition: width 0.5s ease-out;
        }
        
        /* Buttons */
        .btn {
            padding: 8px 18px;
            border-radius: 9999px;
            font-weight: 600;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
        }
        
        .btn:hover { transform: scale(1.04); }
        .btn-primary { 
            background: linear-gradient(135deg, #ec4899, #8b5cf6); 
            color: white; 
            box-shadow: 0 4px 15px rgba(236, 72, 153, 0.4);
        }
        
        /* Navigation buttons for Ataraxy */
        .nav-buttons { display: flex; gap: 12px; justify-content: center; flex-wrap: wrap; }
        
        .nav-btn {
            padding: 14px 28px;
            border-radius: 14px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            transition: all 0.2s;
            font-size: 1.1rem;
        }
        
        .nav-btn:hover { transform: translateY(-3px); }
        
        .nav-btn-home { background: linear-gradient(135deg, #6b7280, #4b5563); color: white; }
        .nav-btn-back { background: linear-gradient(135deg, #f59e0b, #d97706); color: white; }
        .nav-btn-next { 
            background: linear-gradient(135deg, #ec4899, #8b5cf6); 
            color: white; 
            box-shadow: 0 5px 20px rgba(236, 72, 153, 0.4);
        }
        
        /* Language Toggle */
        .lang-toggle {
            position: fixed;
            top: 12px;
            left: 12px;
            z-index: 1000;
            display: flex;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 9999px;
            padding: 4px;
            border: 2px solid rgba(139, 92, 246, 0.4);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.15);
        }
        
        .lang-btn {
            padding: 5px 12px;
            border-radius: 9999px;
            font-weight: 600;
            font-size: 0.85rem;
            cursor: pointer;
            border: none;
            background: transparent;
            color: #6b7280;
        }
        
        .lang-btn.active {
            background: linear-gradient(135deg, #ec4899, #8b5cf6);
            color: white;
        }
        
        /* ELO Tooltip */
        .elo-info {
            position: relative;
            cursor: help;
        }
        
        .elo-tooltip {
            position: absolute;
            bottom: 100%;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(30, 41, 59, 0.98);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.8rem;
            width: 280px;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
            z-index: 100;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            text-align: left;
        }
        
        .elo-info:hover .elo-tooltip {
            opacity: 1;
            visibility: visible;
        }
        
        /* Responsive */
        @media (max-width: 900px) {
            .game-layout { flex-direction: column; }
            .side-panel { max-width: 100%; }
        }
    </style>
</head>
<body class="min-h-screen" translate="no">

<!-- Language Toggle -->
<div class="lang-toggle">
    <button id="lang-en" class="lang-btn" onclick="setLang('en')">EN</button>
    <button id="lang-zh" class="lang-btn active" onclick="setLang('zh')">ä¸­</button>
    <button id="lang-es" class="lang-btn" onclick="setLang('es')">ES</button>
</div>

<!-- Audio - HAPPY MUSIC! Will autoplay on interaction -->
<audio id="bg-music" src="happy_campus.mp3" loop preload="auto"></audio>
<audio id="meditation-music" src="AnaCaptainslogue_-_Noir_Et_Blanc_Vie.mp3" loop preload="auto"></audio>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 1: INTRO - TRANSPARENT TO SHOW BEAUTIFUL BACKGROUND!
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="intro-screen" class="screen active bg-ceremony flex-col items-center justify-end p-4 pb-16">
    <div class="intro-card text-center fade-in">
        <h1 class="text-3xl md:text-4xl font-bold mb-2">
            <span class="bg-gradient-to-r from-pink-500 to-purple-600 bg-clip-text text-transparent">
                Level 2: Propositional Logic
            </span>
        </h1>
        <p class="text-lg text-gray-700 mb-1" data-en="Propositional Logic â€¢ Happy Campus" data-zh="å‘½é¡Œé‚è¼¯ â€¢ Happy Campus å¹¸ç¦æ ¡åœ’" data-es="LÃ³gica Proposicional â€¢ Campus Feliz">å‘½é¡Œé‚è¼¯ â€¢ Happy Campus å¹¸ç¦æ ¡åœ’</p>
        <p class="text-sm text-gray-500 mb-4">Bret Harte Elementary School, Bayview-Hunters Point</p>
        
        <div class="info-box text-left mb-4">
            <div class="flex items-center gap-4 mb-3">
                <div class="text-4xl bounce">ğŸ‰</div>
                <div>
                    <p class="text-lg font-bold text-pink-600" data-en="Award Ceremony + Tiger Paw Store" data-zh="é ’çå…¸ç¦® + Tiger Paw å•†åº—" data-es="Ceremonia de Premios + Tienda Tiger Paw">é ’çå…¸ç¦® + Tiger Paw å•†åº—</p>
                    <p class="text-sm text-gray-500" data-en="Help Roxanne celebrate the students!" data-zh="å¹«åŠ© Roxanne ç‚ºå­¸ç”Ÿæ…¶ç¥ï¼" data-es="Â¡Ayuda a Roxanne a celebrar a los estudiantes!">å¹«åŠ© Roxanne ç‚ºå­¸ç”Ÿæ…¶ç¥ï¼</p>
                </div>
            </div>
            
            <div class="space-y-2 text-sm text-gray-700">
                <p>ğŸ† <span data-en="Part 1: Principal awards Perfect Attendance certificates" data-zh="Part 1ï¼šæ ¡é•·é ’ç™¼å…¨å‹¤çç‹€" data-es="Parte 1: El director entrega certificados de asistencia perfecta">Part 1ï¼šæ ¡é•·é ’ç™¼å…¨å‹¤çç‹€</span></p>
                <p>ğŸ¯ <span data-en="Part 2: Students shop at Tiger Paw Store" data-zh="Part 2ï¼šå­¸ç”Ÿç”¨ Tiger Paw é»æ•¸è³¼ç‰©" data-es="Parte 2: Los estudiantes compran en la Tienda Tiger Paw">Part 2ï¼šå­¸ç”Ÿç”¨ Tiger Paw é»æ•¸è³¼ç‰©</span></p>
                <p>ğŸ§  <span data-en="Learn IF-THEN logic through fun shopping!" data-zh="é€éè³¼ç‰©éŠæˆ²å­¸ç¿’ IF-THEN é‚è¼¯ï¼" data-es="Â¡Aprende lÃ³gica IF-THEN a travÃ©s de compras divertidas!">é€éè³¼ç‰©éŠæˆ²å­¸ç¿’ IF-THEN é‚è¼¯ï¼</span></p>
            </div>
            
            <!-- ELO Explanation -->
            <div class="mt-3 p-3 bg-yellow-50 rounded-lg border border-yellow-200">
                <p class="text-sm text-gray-700">
                    <span class="font-bold text-yellow-600">â­ ELO ç©åˆ†ç³»çµ±</span>
                    <span data-en=" - Like AlphaGo's chess rating!" data-zh=" - å°±åƒ AlphaGo åœæ£‹çš„è¨ˆåˆ†æ–¹å¼ï¼" data-es=" - Â¡Como el rating de ajedrez de AlphaGo!"> - å°±åƒ AlphaGo åœæ£‹çš„è¨ˆåˆ†æ–¹å¼ï¼</span>
                </p>
                <p class="text-xs text-gray-500 mt-1" data-en="Good decisions = higher score. Human vs AI intelligence measure!" data-zh="åšå°æ±ºç­–å¾—åˆ†è¶Šé«˜ã€‚äººæ©Ÿæ™ºæ…§çš„è¡¡é‡æ¨™æº–ï¼" data-es="Buenas decisiones = mayor puntuaciÃ³n. Â¡Medida de inteligencia humana vs IA!">åšå°æ±ºç­–å¾—åˆ†è¶Šé«˜ã€‚äººæ©Ÿæ™ºæ…§çš„è¡¡é‡æ¨™æº–ï¼</p>
            </div>
        </div>
        
        <button onclick="startGame()" class="btn btn-primary text-lg px-10 py-4 pulse-glow">
            ğŸ® <span data-en="Start Ceremony!" data-zh="é–‹å§‹å…¸ç¦®ï¼" data-es="Â¡Iniciar Ceremonia!">é–‹å§‹å…¸ç¦®ï¼</span>
        </button>
        
        <p class="text-xs text-gray-400 mt-3" data-en="ğŸµ Music will play when you start" data-zh="ğŸµ é»æ“Šé–‹å§‹å¾Œæœƒæ’­æ”¾éŸ³æ¨‚" data-es="ğŸµ La mÃºsica comenzarÃ¡ cuando empieces">ğŸµ é»æ“Šé–‹å§‹å¾Œæœƒæ’­æ”¾éŸ³æ¨‚</p>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 2: AWARD CEREMONY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="ceremony-screen" class="screen bg-ceremony flex-col items-center justify-start p-4 pt-32">
    <div class="max-w-3xl w-full">
        <div class="game-header mb-5">
            <div class="text-center flex-1">
                <span class="font-bold text-lg text-purple-700">ğŸ† <span data-en="Perfect Attendance Award" data-zh="å…¨å‹¤çé ’çå…¸ç¦®" data-es="Premio de Asistencia Perfecta">å…¨å‹¤çé ’çå…¸ç¦®</span></span>
            </div>
            <div class="flex items-center gap-3">
                <div class="elo-info">
                    <div class="elo-badge">â­ <span id="elo-ceremony">1200</span></div>
                    <div class="elo-tooltip">
                        <p class="font-bold text-yellow-400 mb-1">ELO Rating System</p>
                        <p class="text-xs">æºè‡ªåœ‹éš›è±¡æ£‹ï¼Œè¢« AlphaGo æ¡ç”¨ã€‚ä»£è¡¨ AI èˆ‡äººé¡æ™ºæ…§æ±ºç­–èƒ½åŠ›çš„è©•åˆ†æ¨™æº–ã€‚</p>
                    </div>
                </div>
                <button onclick="toggleMusic()" class="music-btn" id="music-btn-ceremony">ğŸµ</button>
            </div>
        </div>
        
        <div class="ceremony-stage fade-in">
            <p class="text-sm text-gray-500 mb-3" data-en="Principal announces..." data-zh="æ ¡é•·å®£å¸ƒ..." data-es="El director anuncia...">æ ¡é•·å®£å¸ƒ...</p>
            <p id="principal-speech" class="text-xl text-purple-600 mb-5 font-medium">ã€Œä¸‹ä¸€ä½å¾—çè€…æ˜¯...ã€</p>
            
            <div class="award-student">
                <div id="ceremony-avatar" class="text-6xl mb-3 float">ğŸ‘§ğŸ¿</div>
                <p id="ceremony-name" class="text-2xl font-bold text-gray-800">Aaliyah</p>
                <p id="ceremony-grade" class="text-sm text-gray-500">Grade 3</p>
                <p id="ceremony-achievement" class="text-base text-green-600 mt-2 font-medium">âœ“ å…¨å‹¤å‡ºå¸­ 180 å¤©ï¼</p>
            </div>
            
            <div class="certificate sparkle">
                <h3 class="text-lg font-bold">ğŸ† Perfect Attendance Award</h3>
                <p>Certificate of Excellence</p>
                <p class="text-sm mt-2 font-medium" id="cert-name">Aaliyah</p>
            </div>
            
            <p class="text-base text-gray-600 mt-5 mb-5" data-en="Click to present the award!" data-zh="é»æ“Šé ’ç™¼çç‹€ï¼" data-es="Â¡Haz clic para entregar el premio!">é»æ“Šé ’ç™¼çç‹€ï¼</p>
            <button id="award-btn" onclick="presentAward()" class="award-btn">ğŸ–ï¸ <span data-en="Present Award" data-zh="é ’ç™¼çç‹€" data-es="Entregar Premio">é ’ç™¼çç‹€</span></button>
        </div>
        
        <div class="flex items-center justify-center gap-4 mt-5 text-base">
            <span class="text-white font-medium drop-shadow-lg" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);" data-en="Progress:" data-zh="é€²åº¦ï¼š" data-es="Progreso:">é€²åº¦ï¼š</span>
            <span id="ceremony-progress" class="text-yellow-300 font-bold text-xl drop-shadow-lg" style="text-shadow: 0 2px 4px rgba(0,0,0,0.5);">1 / 6</span>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 3: TIGER PAW STORE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game-screen" class="screen bg-playground flex-col p-3 pt-4">
    <div class="flex-1 flex flex-col gap-3 max-w-7xl mx-auto w-full">
        
        <div class="game-header">
            <div class="text-center flex-1">
                <span class="font-bold text-lg text-orange-600">ğŸ¯ Tiger Paw Store</span>
                <span class="text-sm text-purple-600 ml-3">
                    <span data-en="Student" data-zh="å­¸ç”Ÿ" data-es="Estudiante">å­¸ç”Ÿ</span> <span id="current-student">1</span>/6
                </span>
            </div>
            <div class="flex items-center gap-3">
                <div class="elo-info">
                    <div class="elo-badge">â­ <span id="elo-display">1200</span></div>
                    <div class="elo-tooltip">
                        <p class="font-bold text-yellow-400 mb-1">ELO = æ™ºæ…§æ±ºç­–åˆ†æ•¸</p>
                        <p class="text-xs">åšå°æ±ºå®š +30ï¼Œæ™®é€š +15ã€‚å°±åƒ AlphaGo ä¸‹æ£‹ï¼Œæ¯ä¸€æ­¥éƒ½åœ¨ç´¯ç©æ™ºæ…§ï¼</p>
                    </div>
                </div>
                <button onclick="toggleMusic()" class="music-btn" id="music-btn">ğŸµ</button>
            </div>
        </div>
        
        <div class="progress-container">
            <div id="progress-fill" class="progress-fill" style="width: 0%"></div>
        </div>
        
        <div class="game-layout flex-1">
            <div class="main-area">
                <div class="student-card">
                    <div class="flex items-center justify-center gap-5 flex-wrap">
                        <div id="student-avatar" class="student-avatar">ğŸ‘§ğŸ¿</div>
                        <div class="text-left">
                            <p id="student-name" class="text-2xl font-bold text-gray-800">Aaliyah</p>
                            <p id="student-grade" class="text-sm text-gray-500">Grade 3</p>
                            <p id="student-wish" class="text-base text-pink-600 mt-2">ã€Œæˆ‘æƒ³è¦æ–‡å…·ï¼ã€</p>
                        </div>
                        <div class="tiger-paw-badge">ğŸ¯ <span id="student-points">50</span> <span data-en="pts" data-zh="é»" data-es="pts">é»</span></div>
                    </div>
                </div>
                
                <div class="shop-area flex-1">
                    <div class="flex justify-between items-center">
                        <p class="font-bold text-green-600 text-lg">ğŸª <span data-en="Products" data-zh="å•†å“" data-es="Productos">å•†å“</span></p>
                        <p class="text-sm text-gray-500" data-en="Click to add/remove" data-zh="é»æ“Šæ·»åŠ /ç§»é™¤" data-es="Clic para agregar/quitar">é»æ“Šæ·»åŠ /ç§»é™¤</p>
                    </div>
                    <div id="products-grid" class="products-grid"></div>
                </div>
                
                <div class="cart-area">
                    <div class="flex justify-between items-center mb-2">
                        <p class="font-bold text-green-700 text-base">ğŸ›’ <span data-en="Cart" data-zh="è³¼ç‰©è»Š" data-es="Carrito">è³¼ç‰©è»Š</span></p>
                        <p class="text-xs text-gray-600" data-en="Click to remove" data-zh="é»æ“Šç§»é™¤" data-es="Clic para quitar">é»æ“Šç§»é™¤</p>
                    </div>
                    <div id="cart-items" class="cart-items">
                        <span class="text-gray-500 text-sm">ç©ºçš„ - é»æ“Šä¸Šæ–¹å•†å“ï¼</span>
                    </div>
                    <div class="cart-total">
                        <div class="text-base">
                            <span class="text-gray-600" data-en="Total:" data-zh="ç¸½è¨ˆï¼š" data-es="Total:">ç¸½è¨ˆï¼š</span>
                            <span id="cart-total" class="text-xl font-bold text-orange-600">0</span>
                            <span class="text-gray-600" data-en="pts" data-zh="é»" data-es="pts">é»</span>
                        </div>
                        <div class="text-base">
                            <span class="text-gray-600" data-en="Left:" data-zh="å‰©é¤˜ï¼š" data-es="Restante:">å‰©é¤˜ï¼š</span>
                            <span id="remaining-points" class="text-xl font-bold text-green-600">50</span>
                            <span class="text-gray-600" data-en="pts" data-zh="é»" data-es="pts">é»</span>
                        </div>
                        <button id="checkout-btn" class="checkout-btn" onclick="checkout()" disabled>
                            âœ“ <span data-en="Checkout" data-zh="çµå¸³" data-es="Pagar">çµå¸³</span>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="side-panel">
                <div class="info-box">
                    <div class="info-title">ğŸ“‹ <span data-en="Price List" data-zh="åƒ¹ç›®è¡¨" data-es="Lista de Precios">åƒ¹ç›®è¡¨</span></div>
                    <div id="price-list" class="text-xs grid grid-cols-2 gap-x-3 gap-y-1"></div>
                </div>
                
                <div class="info-box">
                    <div class="info-title">ğŸ§  <span data-en="Logic Check" data-zh="é‚è¼¯æª¢æŸ¥" data-es="VerificaciÃ³n LÃ³gica">é‚è¼¯æª¢æŸ¥</span></div>
                    <div class="logic-rule">
                        <p><span class="text-gray-600" data-en="Budget:" data-zh="é ç®—ï¼š" data-es="Presupuesto:">é ç®—ï¼š</span> <span id="logic-budget" class="logic-true">50</span></p>
                        <p><span class="text-gray-600" data-en="Cart:" data-zh="è³¼ç‰©è»Šï¼š" data-es="Carrito:">è³¼ç‰©è»Šï¼š</span> <span id="logic-cart">0</span></p>
                        <p><span class="text-gray-600" data-en="OK?" data-zh="å¯çµå¸³ï¼Ÿ" data-es="Â¿OK?">å¯çµå¸³ï¼Ÿ</span> <span id="logic-result" class="logic-false">âŒ</span></p>
                    </div>
                    <div class="mt-3 p-3 bg-purple-100 rounded-lg text-sm">
                        <p class="text-purple-700 font-bold">IF-THEN Rule:</p>
                        <p class="text-gray-700 mt-1 mono text-xs">IF cart > 0 AND cart â‰¤ budget<br>THEN checkout = âœ“</p>
                        <p class="text-xs text-purple-500 mt-2 border-t border-purple-200 pt-2">
                            <span data-en="Original formula:" data-zh="åŸå§‹å…¬å¼ï¼š" data-es="FÃ³rmula original:">åŸå§‹å…¬å¼ï¼š</span><br>
                            <span class="mono">(cart > 0) âˆ§ (cart â‰¤ budget) â†’ valid</span>
                        </p>
                    </div>
                </div>
                
                <!-- ğŸ¤– AI æ±ºç­–å¯è¦–åŒ– - æ ¸å¿ƒæ•™è‚²åŠŸèƒ½ï¼ -->
                <div class="info-box" style="background: linear-gradient(135deg, rgba(255,250,235,0.95), rgba(254,243,199,0.92)); border: 3px solid #f59e0b; box-shadow: 0 4px 20px rgba(245,158,11,0.3);">
                    <div class="info-title" style="color: #d97706; font-size: 15px;">ğŸ¤– <span data-en="AI Decision" data-zh="AI æ±ºç­–" data-es="DecisiÃ³n de IA">AI æ±ºç­–</span> <span class="text-xs text-amber-600 font-normal">(AlphaGo Style)</span></div>
                    <div id="ai-decision-panel" class="text-sm">
                        <div class="flex items-center gap-2 mb-2">
                            <span class="text-2xl">ğŸ¯</span>
                            <div>
                                <p class="font-bold text-gray-700" data-en="AI Recommendation:" data-zh="AI å»ºè­°ï¼š" data-es="RecomendaciÃ³n de IA:">AI å»ºè­°ï¼š</p>
                                <p id="ai-suggestion" class="text-orange-600 font-semibold">ç­‰å¾…é¸æ“‡...</p>
                            </div>
                        </div>
                        <div class="bg-white rounded-lg p-2 mt-2 border border-amber-200">
                            <p class="text-xs text-gray-600 mb-1 font-medium" data-en="ELO Prediction:" data-zh="ELO é æ¸¬ï¼š" data-es="PredicciÃ³n ELO:">ELO é æ¸¬ï¼š</p>
                            <div class="flex gap-2">
                                <div id="elo-good" class="flex-1 text-center p-2 rounded-lg bg-green-100 border-2 border-green-400">
                                    <p class="text-xs text-green-700 font-medium">ğŸ˜Š æ»¿æ„</p>
                                    <p class="font-bold text-green-600 text-lg">+30</p>
                                </div>
                                <div id="elo-ok" class="flex-1 text-center p-2 rounded-lg bg-yellow-100 border-2 border-yellow-400">
                                    <p class="text-xs text-yellow-700 font-medium">ğŸ™‚ æ™®é€š</p>
                                    <p class="font-bold text-yellow-600 text-lg">+15</p>
                                </div>
                                <div id="elo-bad" class="flex-1 text-center p-2 rounded-lg bg-red-100 border-2 border-red-400">
                                    <p class="text-xs text-red-700 font-medium">ğŸ˜¢ è¶…æ”¯</p>
                                    <p class="font-bold text-red-600 text-lg">-10</p>
                                </div>
                            </div>
                            <div id="ai-current-status" class="mt-2 p-2 rounded-lg text-center text-sm font-bold" style="background: #fef3c7; border: 1px solid #fcd34d;">
                                <span data-en="Waiting for selection..." data-zh="ç­‰å¾…é¸æ“‡ä¸­..." data-es="Esperando selecciÃ³n...">ç­‰å¾…é¸æ“‡ä¸­...</span>
                            </div>
                        </div>
                        <p class="text-xs text-amber-600 mt-2 italic font-medium" data-en="Like AlphaGo evaluating moves!" data-zh="å°±åƒ AlphaGo è©•ä¼°æ£‹æ­¥ï¼" data-es="Â¡Como AlphaGo evaluando movimientos!">å°±åƒ AlphaGo è©•ä¼°æ£‹æ­¥ï¼</p>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="info-title">ğŸ“Š <span data-en="Score" data-zh="åˆ†æ•¸" data-es="PuntuaciÃ³n">åˆ†æ•¸</span></div>
                    <div class="grid grid-cols-2 gap-3 text-center">
                        <div class="bg-green-100 rounded-xl p-4 border-2 border-green-400">
                            <div class="text-3xl font-bold text-green-600" id="happy-count">0</div>
                            <div class="text-base text-gray-700 mt-1"><span class="text-2xl">ğŸ˜Š</span> <span data-en="Happy" data-zh="é–‹å¿ƒ" data-es="Feliz">é–‹å¿ƒ</span></div>
                        </div>
                        <div class="bg-red-100 rounded-xl p-4 border-2 border-red-400">
                            <div class="text-3xl font-bold text-red-600" id="sad-count">0</div>
                            <div class="text-base text-gray-700 mt-1"><span class="text-2xl">ğŸ˜¢</span> <span data-en="Sad" data-zh="å¤±æœ›" data-es="Triste">å¤±æœ›</span></div>
                        </div>
                    </div>
                </div>
                
                <div class="info-box">
                    <div class="info-title">ğŸ’¡ <span data-en="Tip" data-zh="æç¤º" data-es="Consejo">æç¤º</span></div>
                    <p id="hint-text" class="text-sm text-gray-600">è½è½æ¯ä½å­¸ç”Ÿæƒ³è¦ä»€éº¼ï¼</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 4: RESULT OVERLAY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="result-overlay" class="result-overlay" style="display: none;">
    <div id="result-card" class="result-card correct slide-up">
        <div id="result-emoji" class="text-7xl mb-4">ğŸ˜Š</div>
        <p id="result-title" class="text-2xl font-bold mb-3 text-green-600">Student Happy!</p>
        <p id="result-message" class="text-base text-gray-600 mb-4"></p>
        <p id="result-logic" class="text-sm text-purple-700 mb-5 p-3 bg-purple-100 rounded-lg mono"></p>
        <div id="result-elo" class="text-xl font-bold text-orange-500 mb-5">+30 ELO</div>
        <button onclick="nextStudent()" class="btn btn-primary text-lg px-8 py-3">
            <span data-en="Next" data-zh="ä¸‹ä¸€ä½" data-es="Siguiente">ä¸‹ä¸€ä½</span> â†’
        </button>
    </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCREEN 5: ATARAXY PORTICO - å„ªåŒ–ç‰ˆï¼šåŠ å¤§å­—é«”ã€å¢å¼·å…‰æšˆ
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="ataraxy-screen" class="screen bg-ataraxy flex-col items-center justify-between p-4" style="padding-top: 3vh; padding-bottom: 2vh;">
    <!-- ä¸Šæ–¹å€åŸŸï¼šæ¨™é¡Œ + å‘¼å¸ç’° (å¾€ä¸‹ç§»ä¸€é») -->
    <div class="text-center fade-in" style="position: relative; z-index: 10; margin-top: 2vh;">
        <p class="text-4xl mb-4 font-bold" style="color: #fbbf24; text-shadow: 0 0 20px rgba(251,191,36,0.8), 0 3px 15px rgba(0,0,0,0.3);" data-en="Ataraxy Portico" data-zh="éœå¿ƒä¹‹é–€" data-es="Portal de Serenidad">éœå¿ƒä¹‹é–€</p>
        
        <!-- åŠ å¤§çš„å‘¼å¸ç’° -->
        <div class="breath-ring-enhanced mb-4 mx-auto">
            <span id="breath-counter" class="text-2xl font-bold" style="color: #fbbf24; text-shadow: 0 0 10px #000, 0 0 20px #000, 0 0 30px rgba(251,191,36,1);">æº–å‚™...</span>
        </div>
        
        <p class="text-2xl font-bold" style="color: #fef3c7; text-shadow: 0 0 15px rgba(251,191,36,0.9), 0 2px 10px rgba(0,0,0,0.5);" data-en="Take 3 Deep Breaths" data-zh="æ·±å‘¼å¸ä¸‰æ¬¡" data-es="Respira Profundo 3 Veces">æ·±å‘¼å¸ä¸‰æ¬¡</p>
    </div>
    
    <!-- ä¸­é–“å€åŸŸï¼šéœæ€èªå¡ç‰‡ (åœ¨è“®èŠ±èŠ±æ‰˜èˆ‡æå¹¹ä¹‹é–“) -->
    <div class="text-center" style="position: relative; z-index: 10; margin-top: 20vh;">
        <div class="jingsi-card mx-auto" style="padding: 1.2rem 2rem; max-width: 450px;">
            <p class="text-2xl font-bold mb-2" style="color: #fbbf24; text-shadow: 0 0 10px rgba(0,0,0,0.3);">ã€Œå¿ƒèƒ½è½‰å¢ƒï¼Œå¢ƒéš¨å¿ƒè½‰ã€</p>
            <p class="text-lg" style="color: rgba(255,255,255,0.95); text-shadow: 0 1px 3px rgba(0,0,0,0.3);">Master the mind, master circumstances</p>
            <p class="text-sm mt-2" style="color: rgba(255,255,255,0.8);">â€” è­‰åš´æ³•å¸«éœæ€èª</p>
        </div>
    </div>
    
    <!-- ä¸‹æ–¹å€åŸŸï¼šåˆ†æ•¸ + æŒ‰éˆ• (åœ¨æ°´é¢ä¸Šæ–¹) -->
    <div class="text-center fade-in" style="position: relative; z-index: 10;">
        <div class="space-y-2 mb-5" style="background: rgba(255,255,255,0.3); backdrop-filter: blur(25px); -webkit-backdrop-filter: blur(25px); padding: 1rem 2rem; border-radius: 24px; border: 1px solid rgba(255,255,255,0.4); box-shadow: 0 8px 32px rgba(0,0,0,0.08);">
            <p class="font-bold text-xl" style="color: #fbbf24; text-shadow: 0 0 10px rgba(0,0,0,0.3);" data-en="ğŸ‰ Level 2 Complete!" data-zh="ğŸ‰ ç¬¬äºŒé—œå®Œæˆï¼" data-es="ğŸ‰ Â¡Nivel 2 Completado!">ğŸ‰ Level 2 Complete!</p>
            <p class="font-bold text-2xl" style="color: #fbbf24;"><span data-en="Score:" data-zh="å¾—åˆ†:" data-es="PuntuaciÃ³n:">Score:</span> <span id="final-score">0</span>/6 ğŸ˜Š</p>
            <p class="text-xl font-bold" style="color: #4ade80;">ELO: +<span id="elo-earned">0</span></p>
        </div>
        
        <div class="nav-buttons">
            <button onclick="goHome()" class="nav-btn nav-btn-home">ğŸ  <span data-en="Home" data-zh="ä¸»é " data-es="Inicio">ä¸»é </span></button>
            <button onclick="replayLevel()" class="nav-btn nav-btn-back">ğŸ”„ <span data-en="Replay" data-zh="é‡ç©" data-es="Repetir">é‡ç©</span></button>
            <button onclick="continueJourney()" class="nav-btn nav-btn-next"><span data-en="Next Level" data-zh="ä¸‹ä¸€é—œ" data-es="Siguiente">ä¸‹ä¸€é—œ</span> â†’</button>
        </div>
    </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// LANGUAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentLang = 'zh';

function setLang(lang) {
    currentLang = lang;
    document.getElementById('lang-en').classList.toggle('active', lang === 'en');
    document.getElementById('lang-zh').classList.toggle('active', lang === 'zh');
    document.getElementById('lang-es').classList.toggle('active', lang === 'es');
    document.querySelectorAll('[data-en][data-zh]').forEach(el => {
        const text = el.getAttribute('data-' + lang) || el.getAttribute('data-en');
        el.innerHTML = text;
    });
    if (state.phase === 'shop' && shopStudents[state.shopIndex]) {
        const s = shopStudents[state.shopIndex];
        document.getElementById('student-wish').textContent = 'ã€Œ' + (s.wish[lang] || s.wish.en) + 'ã€';
        document.getElementById('hint-text').textContent = s.hint[lang] || s.hint.en;
    }
    renderProducts();
    renderPriceList();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SCREENS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showScreen(id) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// AUDIO - HAPPY MUSIC!
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let musicPlaying = false;

function startMusic() {
    const music = document.getElementById('bg-music');
    music.volume = 0.4;
    music.play().then(() => {
        musicPlaying = true;
        updateMusicButtons('ğŸµ');
    }).catch(e => console.log('Audio blocked:', e));
}

function toggleMusic() {
    const music = document.getElementById('bg-music');
    if (musicPlaying) {
        music.pause();
        musicPlaying = false;
        updateMusicButtons('ğŸ”‡');
    } else {
        music.volume = 0.4;
        music.play().then(() => {
            musicPlaying = true;
            updateMusicButtons('ğŸµ');
        }).catch(e => console.log('Audio:', e));
    }
}

function updateMusicButtons(icon) {
    const btns = document.querySelectorAll('.music-btn');
    btns.forEach(btn => {
        btn.textContent = icon;
        btn.classList.toggle('muted', icon === 'ğŸ”‡');
    });
}

function playSound(type) {
    try {
        const ctx = new (window.AudioContext || window.webkitAudioContext)();
        const osc = ctx.createOscillator();
        const gain = ctx.createGain();
        osc.connect(gain);
        gain.connect(ctx.destination);
        
        if (type === 'award') {
            osc.frequency.setValueAtTime(523, ctx.currentTime);
            osc.frequency.setValueAtTime(659, ctx.currentTime + 0.1);
            osc.frequency.setValueAtTime(784, ctx.currentTime + 0.2);
            osc.frequency.setValueAtTime(1047, ctx.currentTime + 0.3);
        } else if (type === 'add') {
            osc.frequency.setValueAtTime(880, ctx.currentTime);
        } else if (type === 'correct') {
            osc.frequency.setValueAtTime(523, ctx.currentTime);
            osc.frequency.setValueAtTime(659, ctx.currentTime + 0.1);
            osc.frequency.setValueAtTime(784, ctx.currentTime + 0.2);
        } else if (type === 'wrong') {
            osc.frequency.setValueAtTime(330, ctx.currentTime);
            osc.frequency.setValueAtTime(262, ctx.currentTime + 0.15);
        }
        
        gain.gain.setValueAtTime(0.2, ctx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 0.5);
        osc.start(ctx.currentTime);
        osc.stop(ctx.currentTime + 0.5);
    } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

// ä¸‰èª UI æ–‡å­—
const UI_TEXT = {
    perfect: { en: (days) => `Perfect: ${days} days!`, zh: (days) => `å…¨å‹¤ ${days} å¤©ï¼`, es: (days) => `Â¡Perfecto: ${days} dÃ­as!` },
    nextAward: { en: (name) => `"Next award: ${name}!"`, zh: (name) => `ã€Œä¸‹ä¸€ä½ï¼š${name}ï¼ã€`, es: (name) => `"Â¡Siguiente premio: ${name}!"` },
    empty: { en: 'Empty', zh: 'ç©ºçš„', es: 'VacÃ­o' },
    selectToStart: { en: 'Select items to start!', zh: 'é¸æ“‡å•†å“é–‹å§‹è³¼ç‰©ï¼', es: 'Â¡Selecciona artÃ­culos para empezar!' },
    waiting: { en: 'Waiting for selection...', zh: 'ç­‰å¾…é¸æ“‡ä¸­...', es: 'Esperando selecciÃ³n...' },
    overBudget: { en: 'âš ï¸ Over budget! Remove items.', zh: 'âš ï¸ è¶…æ”¯äº†ï¼è«‹ç§»é™¤å•†å“ã€‚', es: 'âš ï¸ Â¡Excede presupuesto! Quita artÃ­culos.' },
    invalid: { en: 'INVALID - Will lose ELO!', zh: 'ç„¡æ•ˆæ±ºç­– - æœƒæ‰£ ELOï¼', es: 'Â¡INVÃLIDO - PerderÃ¡s ELO!' },
    optimal: { en: 'ğŸ¯ Great choice! Good value!', zh: 'ğŸ¯ å¾ˆæ£’çš„é¸æ“‡ï¼ç‰©è¶…æ‰€å€¼ï¼', es: 'ğŸ¯ Â¡Gran elecciÃ³n! Â¡Buen valor!' },
    optimalStatus: { en: 'OPTIMAL - Max ELO +30!', zh: 'æœ€ä½³æ±ºç­– - ELO +30ï¼', es: 'Â¡Ã“PTIMO - ELO mÃ¡ximo +30!' },
    goodChoice: { en: (pct) => `Good! Using ${pct}% of budget.`, zh: (pct) => `ä¸éŒ¯ï¼ä½¿ç”¨äº† ${pct}% é ç®—ã€‚`, es: (pct) => `Â¡Bien! Usando ${pct}% del presupuesto.` },
    goodStatus: { en: 'GOOD - ELO +15', zh: 'è‰¯å¥½ - ELO +15', es: 'BUENO - ELO +15' },
    overBudgetTitle: { en: 'Over Budget!', zh: 'è¶…é ç®—ï¼', es: 'Â¡Excede Presupuesto!' },
    overBudgetMsg: { en: 'Cart exceeds points!', zh: 'è¶…éå¯ç”¨é»æ•¸ï¼', es: 'Â¡El carrito excede los puntos!' },
    sadTitle: { en: 'A little sad...', zh: 'æœ‰é»é›£é...', es: 'Un poco triste...' },
    sadMsg: { en: (name) => `${name} couldn't get what they really wanted...`, zh: (name) => `${name} è²·ä¸åˆ°çœŸæ­£æƒ³è¦çš„æ±è¥¿...`, es: (name) => `${name} no pudo obtener lo que realmente querÃ­a...` },
    happyTitle: { en: 'So Happy!', zh: 'è¶…é–‹å¿ƒï¼', es: 'Â¡Muy Feliz!' },
    happyMsg: { en: (name) => `${name} got what they wanted!`, zh: (name) => `${name} è²·åˆ°æƒ³è¦çš„äº†ï¼`, es: (name) => `Â¡${name} obtuvo lo que querÃ­a!` },
    okTitle: { en: 'OK!', zh: 'é‚„å¯ä»¥ï¼', es: 'Â¡OK!' },
    okMsg: { en: (name) => `${name} is satisfied.`, zh: (name) => `${name} é‚„ç®—æ»¿æ„ã€‚`, es: (name) => `${name} estÃ¡ satisfecho/a.` }
};

// Helper function to get text
function getText(key, ...args) {
    const textObj = UI_TEXT[key];
    if (!textObj) return key;
    const text = textObj[currentLang] || textObj.en;
    return typeof text === 'function' ? text(...args) : text;
}

// ğŸŒ DIVERSE STUDENTS - Reflecting Bayview-Hunters Point Community
// 
// ğŸ“ æ•™è‚²è¨­è¨ˆï¼š
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ğŸ† å…¨å‹¤ç = +20 Tiger Pawï¼ˆåŸºæœ¬çå‹µï¼Œæ¯å€‹äººéƒ½æœ‰ï¼‰
// ğŸ¯ é¡å¤– Tiger Paw = å¹³æ™‚å–„è¡Œï¼ˆå¹«åŠ©åŒå­¸ã€å‹æ„›ã€ä¸æ¬ºè² äººã€è¡Œç‚ºè‰¯å¥½ï¼‰
//
// âš–ï¸ å¹³è¡¡ï¼šæœ‰é–‹å¿ƒä¹Ÿæœ‰å¤±è½ï¼Œé€™æ‰æ˜¯çœŸå¯¦
// æ•™è‚²æ–¹å¼ï¼šä¸å‘Šè¨´ç­”æ¡ˆï¼Œè®“ç©å®¶è‡ªå·±æ„Ÿå—ã€è‡ªå·±æ‰¾æ–¹å‘

const awardStudents = [
    { name: "Aaliyah", avatar: "ğŸ‘§ğŸ¿", grade: "Grade 3", days: 180 },
    { name: "Wei-Lin å‰ç³", avatar: "ğŸ‘¦ğŸ»", grade: "Grade 4", days: 180 },
    { name: "Marcus", avatar: "ğŸ‘¦ğŸ¿", grade: "Grade 5", days: 180 },
    { name: "Sofia", avatar: "ğŸ‘§ğŸ½", grade: "Grade 2", days: 180 },
    { name: "Mai", avatar: "ğŸ‘§ğŸ»", grade: "Grade 3", days: 180 },
    { name: "Tane", avatar: "ğŸ‘¦ğŸ¾", grade: "Grade 4", days: 180 }
];

const shopStudents = [
    // ğŸ‘§ğŸ¿ Aaliyah - å…¨å‹¤ +20ï¼Œå¹³æ™‚é‚„ä¸éŒ¯ â†’ å…± 38 é»
    { name: "Aaliyah", avatar: "ğŸ‘§ğŸ¿", grade: "Grade 3", points: 38, 
      wish: { en: "I want crayons and notebook!", zh: "æˆ‘æƒ³è¦è Ÿç­†å’Œç­†è¨˜æœ¬ï¼", es: "Â¡Quiero crayones y cuaderno!" }, 
      hint: { en: "ğŸ‰ Perfect attendance! She enjoys coming to school.", zh: "ğŸ‰ å…¨å‹¤çï¼å¥¹å–œæ­¡ä¾†ä¸Šå­¸ã€‚", es: "ğŸ‰ Â¡Asistencia perfecta! Le gusta venir a la escuela." },
      isLowPoints: false },
    
    // ğŸ‘¦ğŸ» Wei-Lin - å…¨å‹¤ +20ï¼Œå¹³æ™‚è¶…æ£’ï¼ˆå¹«åŒå­¸ã€å‹æ„›ï¼‰â†’ å…± 85 é»
    { name: "Wei-Lin å‰ç³", avatar: "ğŸ‘¦ğŸ»", grade: "Grade 4", points: 85, 
      wish: { en: "I want a basketball!", zh: "æˆ‘æƒ³è¦ç±ƒçƒï¼", es: "Â¡Quiero un baloncesto!" }, 
      hint: { en: "ğŸ‰ Perfect attendance! He's always kind to everyone.", zh: "ğŸ‰ å…¨å‹¤çï¼ä»–å°å¤§å®¶éƒ½å¾ˆå‹å–„ã€‚", es: "ğŸ‰ Â¡Asistencia perfecta! Siempre es amable con todos." },
      isLowPoints: false,
      isHelpful: true },
    
    // ğŸ‘¦ğŸ¿ Marcus - å…¨å‹¤ +20ï¼Œä½†å°±åªæœ‰é€™æ¨£ â†’ å…± 20 é»
    // æƒ³è¦ç±ƒçƒ(60é»)ä½†è²·ä¸èµ· â†’ çœŸå¯¦çš„å¤±è½æ„Ÿ
    { name: "Marcus", avatar: "ğŸ‘¦ğŸ¿", grade: "Grade 5", points: 20, 
      wish: { en: "I really want that basketball... ğŸ€", zh: "æˆ‘å¥½æƒ³è¦é‚£å€‹ç±ƒçƒ... ğŸ€", es: "Realmente quiero ese baloncesto... ğŸ€" }, 
      hint: { en: "ğŸ‰ Perfect attendance! He loves playing at recess.", zh: "ğŸ‰ å…¨å‹¤çï¼ä»–æœ€æ„›ä¸‹èª²æ™‚é–“ã€‚", es: "ğŸ‰ Â¡Asistencia perfecta! Le encanta jugar en el recreo." },
      isLowPoints: true },
    
    // ğŸ‘§ğŸ½ Sofia - å…¨å‹¤ +20ï¼Œå¹³æ™‚è¡¨ç¾OK â†’ å…± 42 é»
    { name: "Sofia", avatar: "ğŸ‘§ğŸ½", grade: "Grade 2", points: 42, 
      wish: { en: "Cute things!", zh: "å¯æ„›çš„æ±è¥¿ï¼", es: "Â¡Cosas lindas!" }, 
      hint: { en: "ğŸ‰ Perfect attendance! She loves school breakfast!", zh: "ğŸ‰ å…¨å‹¤çï¼å¥¹æœ€æ„›å­¸æ ¡æ—©é¤ï¼", es: "ğŸ‰ Â¡Asistencia perfecta! Â¡Le encanta el desayuno escolar!" },
      isLowPoints: false },
    
    // ğŸ‘§ğŸ» Mai - å…¨å‹¤ +20ï¼Œä½†å°±åªæœ‰é€™æ¨£ â†’ å…± 20 é»
    // æƒ³è¦é¡æ–™çµ„(35é»)ä½†è²·ä¸èµ· â†’ çœŸå¯¦çš„å¤±è½æ„Ÿ
    { name: "Mai", avatar: "ğŸ‘§ğŸ»", grade: "Grade 3", points: 20, 
      wish: { en: "I wish I could get the paint set... ğŸ¨", zh: "å¥½å¸Œæœ›èƒ½è²·åˆ°é¡æ–™çµ„... ğŸ¨", es: "OjalÃ¡ pudiera obtener el set de pintura... ğŸ¨" }, 
      hint: { en: "ğŸ‰ Perfect attendance! She comes to see her best friend.", zh: "ğŸ‰ å…¨å‹¤çï¼å¥¹æ¯å¤©ä¾†æ‰¾å¥½æœ‹å‹ã€‚", es: "ğŸ‰ Â¡Asistencia perfecta! Viene a ver a su mejor amiga." },
      isLowPoints: true },
    
    // ğŸ‘¦ğŸ¾ Tane - å…¨å‹¤ +20ï¼Œå¹³æ™‚è¶…æ£’ï¼ˆå¹«åŠ©ã€å‹æ„›ã€ä¸æ¬ºè² äººã€è¡Œç‚ºè‰¯å¥½ï¼‰â†’ å…± 95 é»
    { name: "Tane", avatar: "ğŸ‘¦ğŸ¾", grade: "Grade 4", points: 95, 
      wish: { en: "So many choices! ğŸŒŸ", zh: "å¥½å¤šé¸æ“‡ï¼ğŸŒŸ", es: "Â¡Tantas opciones! ğŸŒŸ" }, 
      hint: { en: "ğŸ‰ Perfect attendance! He's always helping and caring for others.", zh: "ğŸ‰ å…¨å‹¤çï¼ä»–ç¸½æ˜¯å¹«åŠ©å’Œé—œå¿ƒåˆ¥äººã€‚", es: "ğŸ‰ Â¡Asistencia perfecta! Siempre ayuda y cuida a los demÃ¡s." },
      isLowPoints: false,
      isRoleModel: true }
];

const products = [
    { emoji: "âœï¸", name: { en: "Pencil", zh: "é‰›ç­†", es: "LÃ¡piz" }, price: 5 },
    { emoji: "ğŸ“", name: { en: "Ruler", zh: "å°º", es: "Regla" }, price: 10 },
    { emoji: "âœ‚ï¸", name: { en: "Scissors", zh: "å‰ªåˆ€", es: "Tijeras" }, price: 15 },
    { emoji: "ğŸ–ï¸", name: { en: "Crayons", zh: "è Ÿç­†", es: "Crayones" }, price: 20 },
    { emoji: "ğŸ“’", name: { en: "Notebook", zh: "ç­†è¨˜æœ¬", es: "Cuaderno" }, price: 15 },
    { emoji: "ğŸ¨", name: { en: "Paint Set", zh: "é¡æ–™çµ„", es: "Set de Pintura" }, price: 35 },
    { emoji: "âš½", name: { en: "Ball", zh: "è¶³çƒ", es: "Pelota" }, price: 40 },
    { emoji: "ğŸ€", name: { en: "Basketball", zh: "ç±ƒçƒ", es: "Baloncesto" }, price: 60 },
    { emoji: "ğŸª€", name: { en: "Jump Rope", zh: "è·³ç¹©", es: "Cuerda" }, price: 25 },
    { emoji: "ğŸ”®", name: { en: "Marbles", zh: "å½ˆç ", es: "Canicas" }, price: 10 },
    { emoji: "ğŸ€", name: { en: "Hair Clips", zh: "é«®å¤¾", es: "Ganchos" }, price: 8 },
    { emoji: "ğŸ§¸", name: { en: "Plush Toy", zh: "ç©å¶", es: "Peluche" }, price: 30 },
    // ğŸ« æ–°å¢å¯¦éš›çå“ï¼
    { emoji: "ğŸ«", name: { en: "Chocolate", zh: "å·§å…‹åŠ›", es: "Chocolate" }, price: 3 },
    { emoji: "ğŸ¥¤", name: { en: "Energy Bar", zh: "èƒ½é‡æ£’", es: "Barra EnergÃ©tica" }, price: 5 },
    { emoji: "ğŸª", name: { en: "Cookies", zh: "é¤…ä¹¾", es: "Galletas" }, price: 4 },
    { emoji: "ğŸ§ƒ", name: { en: "Juice Box", zh: "æœæ±ç›’", es: "Jugo" }, price: 3 }
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const state = {
    phase: 'intro',
    ceremonyIndex: 0,
    shopIndex: 0,
    cart: [],
    elo: 1200,
    eloEarned: 0,
    happyCount: 0,
    sadCount: 0
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// CEREMONY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
    startMusic(); // Play happy music!
    state.phase = 'ceremony';
    state.ceremonyIndex = 0;
    showScreen('ceremony-screen');
    loadCeremonyStudent(0);
}

function loadCeremonyStudent(idx) {
    const s = awardStudents[idx];
    const texts = {
        perfect: { en: `Perfect: ${s.days} days!`, zh: `å…¨å‹¤ ${s.days} å¤©ï¼`, es: `Â¡Perfecto: ${s.days} dÃ­as!` },
        next: { en: `"Next award: ${s.name}!"`, zh: `ã€Œä¸‹ä¸€ä½ï¼š${s.name}ï¼ã€`, es: `"Â¡Siguiente premio: ${s.name}!"` }
    };
    document.getElementById('ceremony-avatar').textContent = s.avatar;
    document.getElementById('ceremony-name').textContent = s.name;
    document.getElementById('ceremony-grade').textContent = s.grade;
    document.getElementById('ceremony-achievement').textContent = 'âœ“ ' + (texts.perfect[currentLang] || texts.perfect.en);
    document.getElementById('cert-name').textContent = s.name;
    document.getElementById('ceremony-progress').textContent = `${idx + 1} / ${awardStudents.length}`;
    document.getElementById('principal-speech').textContent = texts.next[currentLang] || texts.next.en;
    document.getElementById('award-btn').disabled = false;
}

function presentAward() {
    document.getElementById('award-btn').disabled = true;
    playSound('award');
    if (typeof confetti === 'function') confetti({ particleCount: 120, spread: 80, origin: { y: 0.6 } });
    state.elo += 20;
    state.eloEarned += 20;
    document.getElementById('elo-ceremony').textContent = state.elo;
    setTimeout(() => {
        state.ceremonyIndex++;
        if (state.ceremonyIndex >= awardStudents.length) {
            setTimeout(() => {
                state.phase = 'shop';
                state.shopIndex = 0;
                showScreen('game-screen');
                loadShopStudent(0);
                renderProducts();
                renderPriceList();
            }, 600);
        } else {
            loadCeremonyStudent(state.ceremonyIndex);
        }
    }, 1800);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// SHOP
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function loadShopStudent(idx) {
    const s = shopStudents[idx];
    document.getElementById('student-avatar').textContent = s.avatar;
    document.getElementById('student-name').textContent = s.name;
    document.getElementById('student-grade').textContent = s.grade;
    document.getElementById('student-points').textContent = s.points;
    document.getElementById('student-wish').textContent = 'ã€Œ' + (s.wish[currentLang] || s.wish.en) + 'ã€';
    document.getElementById('hint-text').textContent = s.hint[currentLang] || s.hint.en;
    document.getElementById('current-student').textContent = idx + 1;
    document.getElementById('progress-fill').style.width = ((idx / shopStudents.length) * 100) + '%';
    document.getElementById('elo-display').textContent = state.elo;
    state.cart = [];
    updateCart();
    updateLogic(s.points);
    updateProductsAvailability(s.points);
    
    // ğŸ“ è¦–è¦ºè¨­è¨ˆï¼šå…¨å‹¤çç‚ºä¸»è§’ï¼Œä¿æŒæ­£é¢æ°›åœ
    const studentCard = document.querySelector('.student-card');
    const pointsBadge = document.querySelector('.tiger-paw-badge');
    
    if (s.isRoleModel) {
        // æ¨¡ç¯„ç”Ÿ - é‡‘è‰²å…‰èŠ’ï¼ˆè¼•å¾®å¼·èª¿ï¼‰
        studentCard.style.background = 'linear-gradient(135deg, rgba(254,249,195,0.95), rgba(253,224,71,0.9))';
        studentCard.style.border = '3px solid #fbbf24';
        pointsBadge.style.background = 'linear-gradient(135deg, #fde047, #fbbf24)';
        pointsBadge.style.animation = 'pulseGlow 2s infinite';
    } else if (s.isHelpful) {
        // æ¨‚æ–¼åŠ©äºº - æº«æš–ç²‰è‰²
        studentCard.style.background = 'linear-gradient(135deg, rgba(252,231,243,0.95), rgba(249,168,212,0.9))';
        studentCard.style.border = '3px solid #f472b6';
        pointsBadge.style.background = 'linear-gradient(135deg, #fbbf24, #f59e0b)';
        pointsBadge.style.animation = 'none';
    } else {
        // ä¸€èˆ¬å…¨å‹¤çå¾—ä¸» - éƒ½æ˜¯é–‹å¿ƒçš„ç²‰è‰²ï¼ˆå…¨éƒ¨éƒ½å€¼å¾—æ…¶ç¥ï¼ï¼‰
        studentCard.style.background = 'linear-gradient(135deg, rgba(255,255,255,0.95), rgba(252,231,243,0.9))';
        studentCard.style.border = '3px solid #ec4899';
        pointsBadge.style.background = 'linear-gradient(135deg, #fbbf24, #f59e0b)';
        pointsBadge.style.animation = 'none';
    }
}

function renderProducts() {
    document.getElementById('products-grid').innerHTML = products.map((p, i) => `
        <div class="product-item" data-idx="${i}" onclick="addToCart(${i})">
            <div class="product-emoji">${p.emoji}</div>
            <div class="product-name">${p.name[currentLang] || p.name.en}</div>
            <div class="product-price">${p.price} ğŸ¯</div>
        </div>
    `).join('');
    if (shopStudents[state.shopIndex]) updateProductsAvailability(shopStudents[state.shopIndex].points);
}

function renderPriceList() {
    document.getElementById('price-list').innerHTML = products.map(p => `
        <div class="flex justify-between items-center py-0.5"><span class="truncate">${p.emoji} ${p.name[currentLang] || p.name.en}</span><span class="text-orange-600 font-bold ml-1">${p.price}</span></div>
    `).join('');
}

function updateProductsAvailability(budget) {
    const total = state.cart.reduce((sum, i) => sum + products[i].price, 0);
    const remaining = budget - total;
    document.querySelectorAll('.product-item').forEach((el, i) => {
        const inCart = state.cart.includes(i);
        el.classList.toggle('in-cart', inCart);
        el.classList.toggle('disabled', products[i].price > remaining && !inCart);
    });
}

function addToCart(idx) {
    const s = shopStudents[state.shopIndex];
    const total = state.cart.reduce((sum, i) => sum + products[i].price, 0);
    const remaining = s.points - total;
    const existing = state.cart.indexOf(idx);
    if (existing !== -1) {
        state.cart.splice(existing, 1);
    } else if (products[idx].price <= remaining) {
        state.cart.push(idx);
    }
    playSound('add');
    updateCart();
    updateLogic(s.points);
    updateProductsAvailability(s.points);
}

function removeFromCart(idx) {
    state.cart.splice(idx, 1);
    playSound('add');
    const s = shopStudents[state.shopIndex];
    updateCart();
    updateLogic(s.points);
    updateProductsAvailability(s.points);
}

function updateCart() {
    const container = document.getElementById('cart-items');
    const total = state.cart.reduce((sum, i) => sum + products[i].price, 0);
    const s = shopStudents[state.shopIndex];
    const remaining = s ? s.points - total : 0;
    const emptyText = { en: 'Empty', zh: 'ç©ºçš„', es: 'VacÃ­o' };
    
    container.innerHTML = state.cart.length === 0 
        ? `<span class="text-gray-500 text-sm">${emptyText[currentLang] || emptyText.en}</span>`
        : state.cart.map((idx, ci) => `<div class="cart-item" onclick="removeFromCart(${ci})">${products[idx].emoji} <span class="text-orange-600">${products[idx].price}</span></div>`).join('');
    
    document.getElementById('cart-total').textContent = total;
    document.getElementById('remaining-points').textContent = remaining;
    document.getElementById('remaining-points').className = 'text-xl font-bold ' + (remaining >= 0 ? 'text-green-600' : 'text-red-600');
    document.getElementById('checkout-btn').disabled = state.cart.length === 0;
}

function updateLogic(budget) {
    const total = state.cart.reduce((sum, i) => sum + products[i].price, 0);
    const valid = total > 0 && total <= budget;
    document.getElementById('logic-budget').textContent = budget;
    document.getElementById('logic-cart').textContent = total;
    document.getElementById('logic-cart').className = total > budget ? 'logic-false' : '';
    document.getElementById('logic-result').textContent = valid ? 'âœ“' : 'âŒ';
    document.getElementById('logic-result').className = valid ? 'logic-true' : 'logic-false';
    
    // ğŸ¤– AI æ±ºç­–å¯è¦–åŒ–
    updateAIDecision(budget, total);
}

// ğŸ¤– AI æ±ºç­–åˆ†æ - æ ¸å¿ƒæ•™è‚²åŠŸèƒ½
function updateAIDecision(budget, cartTotal) {
    const aiSuggestion = document.getElementById('ai-suggestion');
    const aiStatus = document.getElementById('ai-current-status');
    const eloGood = document.getElementById('elo-good');
    const eloOk = document.getElementById('elo-ok');
    const eloBad = document.getElementById('elo-bad');
    
    // ä¸‰èªæ–‡å­—
    const aiTexts = {
        selectStart: { en: 'Select items to start!', zh: 'é¸æ“‡å•†å“é–‹å§‹è³¼ç‰©ï¼', es: 'Â¡Selecciona artÃ­culos para comenzar!' },
        waiting: { en: 'Waiting for selection...', zh: 'ç­‰å¾…é¸æ“‡ä¸­...', es: 'Esperando selecciÃ³n...' },
        overBudget: { en: 'âš ï¸ Over budget! Remove items.', zh: 'âš ï¸ è¶…æ”¯äº†ï¼è«‹ç§»é™¤å•†å“ã€‚', es: 'âš ï¸ Â¡Excede presupuesto! Quita artÃ­culos.' },
        invalid: { en: 'INVALID - Will lose ELO!', zh: 'ç„¡æ•ˆæ±ºç­– - æœƒæ‰£ ELOï¼', es: 'Â¡INVÃLIDO - PerderÃ¡s ELO!' },
        great: { en: 'ğŸ¯ Great choice! Good value!', zh: 'ğŸ¯ å¾ˆæ£’çš„é¸æ“‡ï¼ç‰©è¶…æ‰€å€¼ï¼', es: 'ğŸ¯ Â¡Gran elecciÃ³n! Â¡Buen valor!' },
        optimal: { en: 'OPTIMAL - Max ELO +30!', zh: 'æœ€ä½³æ±ºç­– - ELO +30ï¼', es: 'Â¡Ã“PTIMO - ELO mÃ¡x +30!' },
        addMore: { en: (n) => `ğŸ’¡ OK, but add ${n}+ pts for max ELO!`, zh: (n) => `ğŸ’¡ å¯ä»¥ï¼Œä½†å†åŠ  ${n}+ é»å¯å¾—æ»¿åˆ†ï¼`, es: (n) => `ğŸ’¡ OK, Â¡pero agrega ${n}+ pts para mÃ¡x ELO!` },
        good: { en: 'GOOD - ELO +15', zh: 'è‰¯å¥½ - ELO +15', es: 'BUENO - ELO +15' }
    };
    
    // é‡ç½®é«˜äº®
    [eloGood, eloOk, eloBad].forEach(el => {
        el.style.transform = 'scale(1)';
        el.style.boxShadow = 'none';
    });
    
    const remaining = budget - cartTotal;
    const utilizationRate = cartTotal / budget;
    
    if (cartTotal === 0) {
        aiSuggestion.textContent = aiTexts.selectStart[currentLang] || aiTexts.selectStart.en;
        aiSuggestion.className = 'text-gray-500';
        aiStatus.textContent = aiTexts.waiting[currentLang] || aiTexts.waiting.en;
        aiStatus.style.background = '#e5e7eb';
        aiStatus.style.color = '#6b7280';
    } else if (cartTotal > budget) {
        aiSuggestion.textContent = aiTexts.overBudget[currentLang] || aiTexts.overBudget.en;
        aiSuggestion.className = 'text-red-600 font-bold';
        aiStatus.innerHTML = `<span class="text-red-600">âŒ ${aiTexts.invalid[currentLang] || aiTexts.invalid.en}</span>`;
        aiStatus.style.background = '#fee2e2';
        aiStatus.style.color = '#dc2626';
        eloBad.style.transform = 'scale(1.1)';
        eloBad.style.boxShadow = '0 0 15px rgba(239,68,68,0.5)';
    } else if (utilizationRate >= 0.5) {
        aiSuggestion.textContent = aiTexts.great[currentLang] || aiTexts.great.en;
        aiSuggestion.className = 'text-green-600 font-bold';
        aiStatus.innerHTML = `<span class="text-green-600">âœ… ${aiTexts.optimal[currentLang] || aiTexts.optimal.en}</span>`;
        aiStatus.style.background = '#dcfce7';
        aiStatus.style.color = '#16a34a';
        eloGood.style.transform = 'scale(1.1)';
        eloGood.style.boxShadow = '0 0 15px rgba(34,197,94,0.5)';
    } else {
        const moreNeeded = Math.ceil(budget * 0.5) - cartTotal;
        const addMoreFn = aiTexts.addMore[currentLang] || aiTexts.addMore.en;
        aiSuggestion.textContent = addMoreFn(moreNeeded);
        aiSuggestion.className = 'text-yellow-600 font-bold';
        aiStatus.innerHTML = `<span class="text-yellow-600">ğŸ”¶ ${aiTexts.good[currentLang] || aiTexts.good.en}</span>`;
        aiStatus.style.background = '#fef9c3';
        aiStatus.style.color = '#ca8a04';
        eloOk.style.transform = 'scale(1.1)';
        eloOk.style.boxShadow = '0 0 15px rgba(202,138,4,0.5)';
    }
}

function checkout() {
    const s = shopStudents[state.shopIndex];
    const total = state.cart.reduce((sum, i) => sum + products[i].price, 0);
    const valid = total > 0 && total <= s.points;
    const good = total >= s.points * 0.5;
    let elo = 0, emoji, title, msg;
    
    // ä¸‰èªçµæœæ–‡å­—
    const resultTexts = {
        overBudget: { en: 'Over Budget!', zh: 'è¶…é ç®—ï¼', es: 'Â¡Excede Presupuesto!' },
        cartExceeds: { en: 'Cart exceeds points!', zh: 'è¶…éå¯ç”¨é»æ•¸ï¼', es: 'Â¡El carrito excede los puntos!' },
        littleSad: { en: 'A little sad...', zh: 'æœ‰é»é›£é...', es: 'Un poco triste...' },
        couldntGet: { en: (name) => `${name} couldn't get what they really wanted...`, zh: (name) => `${name} è²·ä¸åˆ°çœŸæ­£æƒ³è¦çš„æ±è¥¿...`, es: (name) => `${name} no pudo conseguir lo que realmente querÃ­a...` },
        soHappy: { en: 'So Happy!', zh: 'è¶…é–‹å¿ƒï¼', es: 'Â¡Muy Feliz!' },
        gotWanted: { en: (name) => `${name} got what they wanted!`, zh: (name) => `${name} è²·åˆ°æƒ³è¦çš„äº†ï¼`, es: (name) => `Â¡${name} consiguiÃ³ lo que querÃ­a!` },
        ok: { en: 'OK!', zh: 'é‚„å¯ä»¥ï¼', es: 'Â¡OK!' },
        satisfied: { en: (name) => `${name} is satisfied.`, zh: (name) => `${name} é‚„ç®—æ»¿æ„ã€‚`, es: (name) => `${name} estÃ¡ satisfecho/a.` }
    };
    
    // ğŸ“ æ•™è‚²è¨­è¨ˆï¼šçœŸå¯¦å‘ˆç¾ï¼Œä¸èªªæ•™
    // è®“ç©å®¶è‡ªå·±æ„Ÿå—åå·®ï¼Œè‡ªå·±æ‰¾æ–¹å‘
    
    if (!valid) {
        elo = -10; emoji = 'ğŸ˜¢';
        title = resultTexts.overBudget[currentLang] || resultTexts.overBudget.en;
        msg = resultTexts.cartExceeds[currentLang] || resultTexts.cartExceeds.en;
        state.sadCount++;
        playSound('wrong');
    } else if (s.isLowPoints) {
        elo = 15; emoji = 'ğŸ˜¢';
        title = resultTexts.littleSad[currentLang] || resultTexts.littleSad.en;
        const couldntGetFn = resultTexts.couldntGet[currentLang] || resultTexts.couldntGet.en;
        msg = couldntGetFn(s.name);
        state.sadCount++;
        playSound('correct');
    } else if (good) {
        elo = 30; emoji = 'ğŸ˜Š';
        title = resultTexts.soHappy[currentLang] || resultTexts.soHappy.en;
        const gotWantedFn = resultTexts.gotWanted[currentLang] || resultTexts.gotWanted.en;
        msg = gotWantedFn(s.name);
        state.happyCount++;
        playSound('correct');
    } else {
        elo = 15; emoji = 'ğŸ™‚';
        title = resultTexts.ok[currentLang] || resultTexts.ok.en;
        const satisfiedFn = resultTexts.satisfied[currentLang] || resultTexts.satisfied.en;
        msg = satisfiedFn(s.name);
        state.happyCount++;
        playSound('correct');
    }
    
    state.elo += elo;
    state.eloEarned += Math.max(0, elo);
    document.getElementById('happy-count').textContent = state.happyCount;
    document.getElementById('sad-count').textContent = state.sadCount;
    
    const card = document.getElementById('result-card');
    card.className = 'result-card slide-up ' + (emoji === 'ğŸ˜Š' ? 'correct' : emoji === 'ğŸ˜¢' ? 'sad' : 'ok');
    document.getElementById('result-emoji').textContent = emoji;
    document.getElementById('result-title').textContent = title;
    document.getElementById('result-title').className = 'text-2xl font-bold mb-3 ' + 
        (emoji === 'ğŸ˜Š' ? 'text-green-600' : emoji === 'ğŸ˜¢' ? 'text-blue-600' : 'text-yellow-600');
    document.getElementById('result-message').textContent = msg;
    
    // ç°¡å–®çš„é‚è¼¯é¡¯ç¤ºï¼Œä¸èªªæ•™
    document.getElementById('result-logic').innerHTML = 
        `Budget: ${s.points} | Cart: ${total} | ${total <= s.points ? '<span class="text-green-600">âœ“</span>' : '<span class="text-red-600">âœ—</span>'}`;
    
    document.getElementById('result-elo').textContent = (elo >= 0 ? '+' : '') + elo + ' ELO';
    document.getElementById('result-elo').className = 'text-xl font-bold mb-5 ' + (elo >= 0 ? 'text-orange-500' : 'text-red-500');
    
    document.getElementById('result-overlay').style.display = 'flex';
    if (emoji === 'ğŸ˜Š' && typeof confetti === 'function') {
        confetti({ particleCount: 80, spread: 70, origin: { y: 0.7 } });
    }
}

function nextStudent() {
    document.getElementById('result-overlay').style.display = 'none';
    state.shopIndex++;
    if (state.shopIndex >= shopStudents.length) completeLevel();
    else { loadShopStudent(state.shopIndex); renderProducts(); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// COMPLETE & NAVIGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function completeLevel() {
    document.getElementById('bg-music').pause();
    musicPlaying = false;
    const med = document.getElementById('meditation-music');
    med.volume = 0.5;
    med.play().catch(e => {});
    document.getElementById('final-score').textContent = state.happyCount;
    document.getElementById('elo-earned').textContent = state.eloEarned;
    showScreen('ataraxy-screen');
    startBreathing();
    if (typeof confetti === 'function') setTimeout(() => confetti({ particleCount: 180, spread: 100, origin: { y: 0.5 } }), 800);
}

function startBreathing() {
    const el = document.getElementById('breath-counter');
    const breathTexts = {
        inhale: { en: 'Inhale...', zh: 'æ·±å‘¼å¸...', es: 'Inhala...' },
        exhale: { en: 'Exhale...', zh: 'åæ°£...', es: 'Exhala...' },
        done: 'ğŸ™'
    };
    
    let cycle = 0;
    const totalCycles = 3;
    
    function breathCycle() {
        if (cycle >= totalCycles) {
            el.textContent = breathTexts.done;
            el.style.fontSize = '4rem';
            return;
        }
        
        // æ·±å‘¼å¸ 4ç§’
        el.textContent = breathTexts.inhale[currentLang] || breathTexts.inhale.en;
        el.style.fontSize = '1.5rem';
        
        setTimeout(() => {
            // åæ°£ 4ç§’
            el.textContent = breathTexts.exhale[currentLang] || breathTexts.exhale.en;
            
            setTimeout(() => {
                cycle++;
                breathCycle();
            }, 4000);
        }, 4000);
    }
    
    // é–‹å§‹å‘¼å¸å¾ªç’°
    setTimeout(breathCycle, 1000);
}

function goHome() {
    document.getElementById('meditation-music').pause();
    window.location.href = '../index.html';
}

function replayLevel() {
    document.getElementById('meditation-music').pause();
    resetState();
    showScreen('intro-screen');
}

function continueJourney() {
    document.getElementById('meditation-music').pause();
    window.location.href = '../level3/index.html';
}

function resetState() {
    state.phase = 'intro';
    state.ceremonyIndex = 0;
    state.shopIndex = 0;
    state.cart = [];
    state.happyCount = 0;
    state.sadCount = 0;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
document.addEventListener('DOMContentLoaded', () => {
    console.log('ğŸ¯ Level 2 Ready!');
    console.log('ğŸµ Music: happy_campus.mp3');
});
</script>

</body>
</html>
